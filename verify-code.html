<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Enter Verification Code | GuaranteedCommission.com</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-900">
  <div class="max-w-md mx-auto mt-12 bg-white p-6 md:p-8 rounded shadow">
    <h1 class="text-2xl md:text-3xl font-bold text-center">Enter Verification Code</h1>
    <p class="text-center text-xs text-gray-500 mt-1">
      Please enter the 6-digit code we sent to your email or phone.
    </p>

    <form id="verifyForm" class="space-y-4 mt-6" autocomplete="off">
      <input 
        id="enteredCode" 
        type="text" 
        maxlength="6" 
        class="w-full border rounded p-2 text-center tracking-widest text-lg" 
        placeholder="______" 
        required
      />
      <p id="errorMsg" class="hidden text-xs text-red-600 text-center">Incorrect code. Please try again.</p>

      <button type="submit" class="w-full bg-green-600 text-white py-2 rounded font-semibold">
        Verify &amp; Continue
      </button>
    </form>

    <div class="mt-4 text-center text-sm">
      <button 
        type="button" 
        id="resendCode" 
        class="text-blue-600 hover:underline">
        Resend Code
      </button>
    </div>
  </div>

  <script>
    const verifyForm = document.getElementById("verifyForm");
    const enteredCodeInput = document.getElementById("enteredCode");
    const errorMsg = document.getElementById("errorMsg");
    const resendButton = document.getElementById("resendCode");

    verifyForm.addEventListener("submit", function(e) {
      e.preventDefault();
      const storedCode = localStorage.getItem("verificationCode");
      const enteredCode = enteredCodeInput.value.trim();

      if (enteredCode === storedCode) {
        // Verification success
        errorMsg.classList.add("hidden");

        // In production, this could branch by selectedPlan
        const selectedPlan = localStorage.getItem("selectedPlan") || "Listed Property Basic";
        if (selectedPlan.includes("Listed Property Basic") || selectedPlan.includes("Listed Property Plus") || selectedPlan.includes("FSBO Plus")) {
          window.location.href = "/upsell.html";
        } else {
          window.location.href = "/";
        }
      } else {
        errorMsg.classList.remove("hidden");
      }
    });

    resendButton.addEventListener("click", function() {
      const code = Math.floor(100000 + Math.random() * 900000);
      localStorage.setItem("verificationCode", code);

      const accountData = JSON.parse(localStorage.getItem("accountData") || "{}");
      const contact = accountData.email || accountData.phone || "your contact info";

      alert(`Test mode: New verification code sent to ${contact}: ${code}`);
    });
  </script>
</body>
</html>
