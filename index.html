<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>GuaranteedCommission.com</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .font-cursive { font-family: 'Brush Script MT', cursive; }
    /* Nav hover */
    .group:hover #commissionMenu,
    .group:focus-within #commissionMenu { display: block; }
    /* Keep menus hidden by default */
    #commissionMenu { display: none; }

    /* --- Strip 2 tile styles --- */
    .gc-tile { background:#fff; border-radius:0.75rem; overflow:hidden; box-shadow:0 1px 6px rgba(0,0,0,.08); }
    .gc-photo { width:100%; height:180px; object-fit:cover; background:#e5e7eb; }
    .gc-ribbon { position:absolute; top:10px; left:10px; background:rgba(0,0,0,.7); color:#fff; font-size:12px; padding:4px 8px; border-radius:6px; }
    .gc-line1 { font-weight:700; }
    .gc-meta  { color:#4b5563; font-size:14px; }
    .gc-broker { color:#6b7280; font-size:12px; text-transform:uppercase; }
  </style>
</head>
<body class="bg-gray-100 text-gray-800">
  <!-- Header -->
  <header class="bg-white shadow">
    <div class="flex justify-between items-center max-w-7xl mx-auto px-4 py-4">
      <button onclick="openInvestorModal()" class="bg-red-600 text-white text-xs font-semibold px-3 py-1 rounded">
        Accredited Investors Only
      </button>
      <div class="text-center flex-1">
        <h1 class="text-3xl font-bold">GuaranteedCommission.com</h1>
        <p class="text-sm text-red-600 mt-1 px-2">
          Guaranteeing commissions so your home will sell quickly at a higher price.
        </p>
      </div>
      <button onclick="openPressModal()" class="bg-blue-600 text-white text-xs font-semibold px-3 py-1 rounded">
        Press Inquiry
      </button>
    </div>
  </header>

  <!-- Investor Modal -->
  <div id="investorModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
    <div class="bg-white rounded-lg shadow-lg p-6 w-96 relative">
      <button onclick="closeInvestorModal()" class="absolute top-2 right-2 text-xl font-bold">&times;</button>
      <h2 class="text-lg font-bold mb-4">Accredited Investor Certification</h2>
      <label class="block mb-2"><input type="checkbox"> Net worth exceeds $1M</label>
      <label class="block mb-2"><input type="checkbox"> Annual income exceeds $200K</label>
      <input type="text" id="investorName" placeholder="Full Name" class="w-full border p-1 mb-2 rounded">
      <input type="tel" id="investorPhone" placeholder="Phone Number" class="w-full border p-1 mb-2 rounded">
      <input type="email" id="investorEmail" placeholder="Email Address" class="w-full border p-1 mb-4 rounded">
      <button onclick="submitInvestorForm()" class="w-full bg-blue-600 text-white py-2 rounded">Submit</button>
      <p id="investorConfirmation" class="mt-4 text-green-600 font-semibold text-center hidden">We will be in touch.</p>
    </div>
  </div>

  <!-- Press Modal -->
  <div id="pressModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
    <div class="bg-white rounded-lg shadow-lg p-6 w-96 relative">
      <button onclick="closePressModal()" class="absolute top-2 right-2 text-xl font-bold">&times;</button>
      <h2 class="text-lg font-bold mb-4">Press Inquiry Form</h2>
      <input type="text" id="pressName" placeholder="Full Name" class="w-full border p-1 mb-2 rounded">
      <input type="text" id="pressOrg" placeholder="Organization" class="w-full border p-1 mb-2 rounded">
      <input type="tel" id="pressPhone" placeholder="Phone Number" class="w-full border p-1 mb-2 rounded">
      <input type="email" id="pressEmail" placeholder="Email Address" class="w-full border p-1 mb-4 rounded">
      <button onclick="submitPressForm()" class="w-full bg-blue-600 text-white py-2 rounded">Submit</button>
      <p id="pressConfirmation" class="mt-4 text-green-600 font-semibold text-center hidden">We will be in touch.</p>
    </div>
  </div>

  <!-- Nav -->
  <nav class="bg-gray-200 py-2">
    <ul class="flex justify-center space-x-8 font-semibold">
      <li class="relative group">
        <span class="hover:underline cursor-pointer">Communicate Guaranteed Commission</span>
        <ul id="commissionMenu" class="absolute left-0 mt-2 w-64 bg-white border shadow text-sm text-gray-700 z-10">
          <li><a href="#" onclick="selectPlan('Listed Property Basic')" class="block px-4 py-2 hover:bg-gray-100">Listed Property Basic</a></li>
          <li><a href="#" onclick="selectPlan('Listed Property Plus')" class="block px-4 py-2 hover:bg-gray-100">Listed Property Plus</a></li>
          <li><a href="#" onclick="selectPlan('FSBO Plus')" class="block px-4 py-2 hover:bg-gray-100">FSBO Plus</a></li>
        </ul>
      </li>
      <li><a href="#strip2Search" class="hover:underline">Search Guaranteed Commission</a></li>
      <li><a href="/login.html" class="hover:underline">Log In</a></li>
    </ul>
  </nav>

  <!-- Strip 1 -->
  <section class="flex flex-col md:flex-row justify-center items-start gap-6 px-4 py-8 max-w-7xl mx-auto">
    <!-- Box 1 -->
    <div class="w-full md:w-1/3 bg-white p-4 rounded shadow text-sm">
      <h2 class="text-lg font-bold mb-4 text-center">Commission Communication Menu</h2>
      <ul class="space-y-3">
        <li>
          <div onclick="selectPlan('Listed Property Basic')" class="cursor-pointer">
            <p class="text-base font-semibold">Listed Property Basic | <span class="text-red-600">FREE</span></p>
            <p class="text-gray-600 pl-5">Printable commission letter, map search, listing price, main photo, address, square footage, bedrooms, bathrooms, listing brokerage, listing agent, listing agent phone number.</p>
          </div>
        </li>
        <li>
          <div onclick="selectPlan('Listed Property Plus')" class="cursor-pointer">
            <p class="text-base font-semibold">Listed Property Plus | $20</p>
            <p class="text-gray-600 pl-5">Listed Property Basic plus 20 photos and full property description.</p>
          </div>
        </li>
        <li>
          <div onclick="selectPlan('FSBO Plus')" class="cursor-pointer">
            <p class="text-base font-semibold">FSBO Plus | $100</p>
            <p class="text-gray-600 pl-5">Listed Property Plus minus the listing agency. Includes showing instructions.</p>
          </div>
        </li>
      </ul>
    </div>

    <!-- Box 2 (form) and Box 3 (ISC) remain unchanged from your baseline … -->
    <!-- … (keeping frozen; omitted here only for brevity of this display) -->
    <!-- In your production file, this section is exactly as previously sent and used. -->

    <!-- Box 3 and rest of Strip 1 kept identical to your baseline -->
  </section>

  <!-- Strip 2: Search / Tiles -->
  <section id="strip2Search" class="max-w-7xl mx-auto px-4 pb-12">
    <div class="flex items-center justify-between mb-3">
      <h2 class="text-xl font-bold">Explore Listings</h2>
      <div class="flex items-center gap-2">
        <input id="searchBox" type="text" placeholder="Search address, city, or state…" class="border rounded px-3 py-2 w-64">
        <button id="searchBtn" class="bg-blue-600 text-white px-3 py-2 rounded">Search</button>
      </div>
    </div>
    <p class="text-sm text-gray-600 mb-4">These tiles are generated from your current session data (or sample data for demo).</p>
    <div id="tileGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5"></div>
  </section>

  <!-- Scripts -->
  <script>
    /* Header modals */
    function openInvestorModal(){ document.getElementById('investorModal').classList.remove('hidden'); }
    function closeInvestorModal(){ document.getElementById('investorModal').classList.add('hidden'); }
    function submitInvestorForm(){ document.getElementById('investorConfirmation').classList.remove('hidden'); }

    function openPressModal(){ document.getElementById('pressModal').classList.remove('hidden'); }
    function closePressModal(){ document.getElementById('pressModal').classList.add('hidden'); }
    function submitPressForm(){ document.getElementById('pressConfirmation').classList.remove('hidden'); }

    // Robust US address validator
    function isValidFullAddress(s) {
      if (!s) return false;
      const re = /^\s*.+?,\s*[A-Za-z .'\-]+,\s*[A-Za-z]{2}\s+\d{5}(?:-\d{4})?\s*$/;
      return re.test(s.trim());
    }

    /* Plan switcher */
    function selectPlan(planName){
      localStorage.setItem("selectedPlan", planName);
      showForm(planName === "FSBO Plus" ? "fsbo" : (planName === "Listed Property Plus" ? "plus" : "listed"));
    }

    /* Toggle which form text appears */
    function showForm(type){
      const title = document.getElementById("formTitle");
      const phoneInput = document.getElementById('agentPhone');
      const brokerageInput = document.getElementById('brokerage');
      const agentInput = document.getElementById('agent');
      const fsboEmailRow = document.getElementById('fsboEmailRow');
      const listedPhoneRow = document.getElementById('listedPhoneRow');

      if(type === 'fsbo'){
        title.textContent = 'FSBO Communication Form';
        listedPhoneRow.classList.remove('hidden');
        phoneInput.placeholder = 'Owner/Seller phone number';

        brokerageInput.style.display = 'none';
        agentInput.style.display = 'none';
        fsboEmailRow.classList.remove('hidden');

        document.getElementById('iscTextListed').classList.add('hidden');
        document.getElementById('iscTextFSBO').classList.remove('hidden');
      } else {
        title.textContent = (type === 'plus' ? 'Listed Property Plus Communication Form' : 'Listed Property Communication Form');
        listedPhoneRow.classList.remove('hidden');
        phoneInput.placeholder = 'Agent’s direct phone only – NOT your number';

        brokerageInput.style.display = 'block';
        agentInput.style.display = 'block';
        fsboEmailRow.classList.add('hidden');

        document.getElementById('iscTextListed').classList.remove('hidden');
        document.getElementById('iscTextFSBO').classList.add('hidden');
      }
    }

    /* On load: default to Listed mode, render tiles */
    window.addEventListener('DOMContentLoaded', () => {
      const lastSelected = localStorage.getItem('selectedPlan') || 'Listed Property Basic';
      showForm('listed');
      localStorage.setItem('selectedPlan', lastSelected.includes('FSBO') ? 'Listed Property Basic' : lastSelected);

      // Phone mask
      const phoneInput = document.getElementById('agentPhone');
      const phoneError = document.getElementById('phoneError');
      phoneInput.addEventListener('input', function(){
        let v = this.value.replace(/\D/g,'').slice(0,10);
        if(v.length>3 && v.length<=6) v = v.replace(/(\d{3})(\d+)/,'$1-$2');
        else if(v.length>6) v = v.replace(/(\d{3})(\d{3})(\d+)/,'$1-$2-$3');
        this.value = v;
        const ok = /^\d{3}-\d{3}-\d{4}$/.test(this.value);
        phoneInput.classList.toggle('border-red-500', !ok);
        phoneError.classList.toggle('hidden', ok);
      });

      // Sync to ISC
      ['name','address','apn','brokerage','agent','agentPhone','commission'].forEach(id=>{
        const el=document.getElementById(id); if(!el) return;
        el.addEventListener('input', syncAll);
      });
      document.getElementById('commissionType').addEventListener('change', syncAll);

      function syncAll(){
        const fullAddr = (document.getElementById('address').value || '').trim();
        const short = fullAddr.split(',')[0] || '';
        const nameVal = document.getElementById('name').value || '';
        const apnVal = document.getElementById('apn').value || '';
        const phoneVal = document.getElementById('agentPhone').value || '';
        const brokerageVal = document.getElementById('brokerage').value || '';
        const agentVal = document.getElementById('agent').value || '';
        const fsboEmailInput = document.getElementById('fsboEmailInput');
        const amount = (document.getElementById('commission').value || '').trim();
        const type = document.getElementById('commissionType').value;
        const suffix = type === '%' ? 'of the total purchase price' : '';
        const display = type === '$' ? ('$' + amount) : (amount ? amount + '%' : '');

        // Listed
        document.getElementById('letterName').textContent = nameVal || '[name]';
        document.getElementById('letterAddressFull').textContent = fullAddr || '[full address]';
        if (apnVal.trim()) {
          document.getElementById('letterAPN').textContent = apnVal;
          document.getElementById('apnSpanListed').classList.remove('hidden');
        } else {
          document.getElementById('apnSpanListed').classList.add('hidden');
        }
        document.getElementById('letterAddressShort1').textContent = short || '[short address]';
        document.getElementById('letterAddressShort2').textContent = short || '[short address]';
        document.getElementById('letterBrokerage').textContent = brokerageVal || '[listing brokerage]';
        document.getElementById('letterAgent').textContent = agentVal || '[listing agent]';
        document.getElementById('letterAgentPhone').textContent = phoneVal || '[agent phone]';
        document.getElementById('letterCommissionDisplay').textContent = display || '[commission]';
        document.getElementById('commissionSuffix').textContent = display ? (' ' + suffix) : '';
        document.getElementById('signatureName').textContent = nameVal || '[Name]';

        // FSBO
        document.getElementById('letterNameFSBO').textContent = nameVal || '[name]';
        document.getElementById('letterAddressFullFSBO').textContent = fullAddr || '[full address]';
        document.getElementById('letterAddressShort1FSBO').textContent = short || '[short address]';
        document.getElementById('letterAddressShort2FSBO').textContent = short || '[short address]';
        document.getElementById('letterAPNFSBO').textContent = apnVal || '[Parcel # / Pin # / Tax ID # / Folio # / APN #]';
        document.getElementById('fsboPhone').textContent = phoneVal || '[owner/seller phone number]';
        document.getElementById('fsboEmail').textContent = (fsboEmailInput && fsboEmailInput.value) || '[owner/seller email]';
        document.getElementById('letterCommissionDisplayFSBO').textContent = display || '[commission]';
        document.getElementById('commissionSuffixFSBO').textContent = display ? (' ' + suffix) : '';
        document.getElementById('signatureNameFSBO').textContent = nameVal || '[Name]';
      }
      syncAll();

      // ---- Strip 2 tiles + search ----
      buildTilesDataset();
      renderStrip2Tiles();
      wireSearch();
    });

    /* Submit (unchanged) */
    function submitForm(){
      const isFSBO = document.getElementById('formTitle').textContent.includes('FSBO');
      const requiredIds = ['name','address','agentPhone'];
      if (isFSBO) requiredIds.push('apn','fsboEmailInput');
      let ok=true;
      for(const id of requiredIds){
        const el=document.getElementById(id);
        if(!el||!el.value.trim()){ if(el) el.classList.add('border-red-500'); ok=false; }
        else el.classList.remove('border-red-500');
      }
      if(!ok){ alert('Please complete all required fields.'); return; }

      const addressEl=document.getElementById('address');
      const addrVal=(addressEl.value||'').trim();
      if(!isValidFullAddress(addrVal)){
        addressEl.classList.add('border-red-500');
        alert('Please use full address format: Street, City, ST 12345');
        return;
      } else addressEl.classList.remove('border-red-500');

      const fsboEmailEl=document.getElementById('fsboEmailInput');
      const formData={
        name:document.getElementById('name').value.trim(),
        address:addrVal,
        apn:document.getElementById('apn').value.trim(),
        commission:document.getElementById('commission').value.trim(),
        commissionType:document.getElementById('commissionType').value,
        phone:document.getElementById('agentPhone').value.trim(),
        brokerage:document.getElementById('brokerage').value.trim(),
        agent:document.getElementById('agent').value.trim(),
        fsboEmail:fsboEmailEl?fsboEmailEl.value.trim():''
      };
      localStorage.setItem("formData",JSON.stringify(formData));
      if(formData.address){
        const short=formData.address.split(',')[0];
        localStorage.setItem('shortAddress',short);
      }
      const plan=localStorage.getItem('selectedPlan')||'Listed Property Basic';
      localStorage.setItem('postSignatureOptions',plan.includes('FSBO')?'fsbo':'listed');
      localStorage.setItem('nextAfterLogin','/verify-code.html');
      window.location.href="/login.html";
    }

    // ---------- Strip 2 helpers ----------
    function fmtUSD(n){ const v=Number(n||0); return v?("$"+v.toLocaleString()):"$—"; }
    function commissionDollars(price, val, type){
      const p=Number(price||0), c=Number(val||0);
      if(!c) return null;
      if(type==='$') return Math.round(c);
      if(p) return Math.round(p*(c/100));
      return null;
    }

    // UPDATED TILE: no button; clickable card; aligned L/C/R line-1
    function renderTile(data){
      const {
        address="[full address]",
        price,
        commission,
        commissionType="%",
        bannerText="",
        photos=[],
        primaryIndex=0,
        status="Active",
        brokerage="[listing brokerage]",
        agent="[listing agent]",
        plan="Listed Property Basic",
        bedrooms, bathrooms, sqft
      } = data || {};

      const calc = commissionDollars(price, commission, commissionType);
      const line1Left  = fmtUSD(price);
      const line1Mid   = commission ? (commissionType==='%' ? `${commission}%` : `$${Number(commission).toLocaleString()}`) : '—';
      const line1Right = (calc!=null) ? `$${calc.toLocaleString()}` : '—';

      const img = (photos && photos.length ? photos[primaryIndex||0] : "");

      const card = document.createElement('article');
      card.className = "gc-tile cursor-pointer";
      card.onclick = () => {
        // Zillow-style: whole tile navigates
        window.location.href = "/listing.html";
      };

      card.innerHTML = `
        <div class="relative">
          <img class="gc-photo" src="${img || ''}" alt="Listing photo">
          ${bannerText ? `<div class="gc-ribbon">${bannerText}</div>` : ``}
        </div>
        <div class="p-3 space-y-1">
          <!-- Line 1: Price (left) | % (center) | $ total (right) -->
          <div class="grid grid-cols-3 items-center text-sm font-semibold">
            <div class="text-left truncate">${line1Left}</div>
            <div class="text-center truncate">${line1Mid}</div>
            <div class="text-right truncate">${line1Right}</div>
          </div>

          <!-- Line 2: BDS | BA | SQFT | STATUS -->
          <div class="text-[12px] text-gray-700 flex items-center gap-2 flex-wrap">
            <span class="px-2 py-0.5 bg-gray-100 rounded">BDS ${bedrooms ?? '—'}</span>
            <span class="px-2 py-0.5 bg-gray-100 rounded">BA ${bathrooms ?? '—'}</span>
            <span class="px-2 py-0.5 bg-gray-100 rounded">SQFT ${sqft ? Number(sqft).toLocaleString() : '—'}</span>
            <span class="px-2 py-0.5 rounded ${
              (status||'').toLowerCase()==='active'?'bg-emerald-100 text-emerald-700':
              (status||'').toLowerCase().includes('contract')?'bg-amber-100 text-amber-700':
              (status||'').toLowerCase()==='sold'?'bg-rose-100 text-rose-700':'bg-gray-100 text-gray-700'
            }">${status||'Draft'}</span>
          </div>

          <!-- Line 3: Full address -->
          <div class="text-sm font-medium">${address}</div>

          <!-- Line 4: Brokerage, Agent, Phone -->
          <div class="text-[12px] text-gray-600">
            ${((plan||'').includes('FSBO') ? 'FOR SALE BY OWNER' : (brokerage||'[listing brokerage]')).toUpperCase()}
            ${agent ? ' — '+agent : ''}${data.agentPhone ? ' — '+data.agentPhone : ''}
          </div>
        </div>
      `;
      return card;
    }

    let _tilesData = [];
    function buildTilesDataset(){
      _tilesData = [];
      const formData = JSON.parse(localStorage.getItem('formData') || '{}');
      const agentListing = JSON.parse(localStorage.getItem('agentListing') || '{}');
      const plan = (localStorage.getItem('selectedPlan') || 'Listed Property Basic').trim();

      const hasLive = formData && formData.address;
      if (hasLive) {
        _tilesData.push({
          address: formData.address,
          price: agentListing.price,
          commission: agentListing.commission ?? formData.commission,
          commissionType: agentListing.commissionType ?? formData.commissionType ?? '%',
          bannerText: agentListing.bannerText,
          photos: Array.isArray(agentListing.photos) ? agentListing.photos : [],
          primaryIndex: typeof agentListing.primaryIndex==='number' ? agentListing.primaryIndex : 0,
          status: agentListing.status || 'Active',
          brokerage: formData.brokerage,
          agent: formData.agent,
          agentPhone: formData.agentPhone,
          plan,
          bedrooms: agentListing.bedrooms,
          bathrooms: agentListing.bathrooms,
          sqft: agentListing.sqft,
        });
      }

      // Samples for demo
      const samples = [
        {
          address: "237 San Joaquin Street, Laguna Beach, CA 92651",
          price: 1895000, commission: 2.5, commissionType: '%',
          bannerText: "Open Sunday 1–4",
          photos: ["https://images.unsplash.com/photo-1560518883-ce09059eeffa?q=80&w=1200&auto=format&fit=crop"],
          primaryIndex: 0, status: "Active",
          brokerage: "Pacific Estates", agent: "Jordan Crisp",
          plan: "Listed Property Plus", bedrooms: 3, bathrooms: 2, sqft: 2000, agentPhone: "(949) 555-1212"
        },
        {
          address: "14 Maple Ave, Montclair, NJ 07042",
          price: 925000, commission: 25000, commissionType: '$',
          photos: ["https://images.unsplash.com/photo-1570129477492-45c003edd2be?q=80&w=1200&auto=format&fit=crop"],
          primaryIndex: 0, status: "In Contract",
          brokerage: "HomeWorks Realty", agent: "A. Brooks",
          plan: "Listed Property Basic", bedrooms: 4, bathrooms: 3, sqft: 2400, agentPhone: "(973) 555-2121"
        },
        {
          address: "1020 Cedar Dr, Austin, TX 78704",
          price: 650000, commission: 3.0, commissionType: '%',
          bannerText: "Hot Home",
          photos: ["https://images.unsplash.com/photo-1600585154526-990dced4db0d?q=80&w=1200&auto=format&fit=crop"],
          primaryIndex: 0, status: "Active",
          brokerage: "", agent: "",
          plan: "FSBO Plus", bedrooms: 3, bathrooms: 2, sqft: 1680, agentPhone: ""
        }
      ];
      const haveAddr = new Set(_tilesData.map(d => (d.address||'').toLowerCase()));
      samples.forEach(s => { if(!haveAddr.has((s.address||'').toLowerCase())) _tilesData.push(s); });
    }

    function renderStrip2Tiles(filterText=""){
      const grid = document.getElementById('tileGrid');
      grid.innerHTML = '';
      const q = (filterText || '').toLowerCase();
      const list = q
        ? _tilesData.filter(d => (d.address||'').toLowerCase().includes(q))
        : _tilesData;
      if (!list.length) {
        grid.innerHTML = `<div class="text-sm text-gray-500">No results. Try a different search.</div>`;
        return;
      }
      list.forEach(d => grid.appendChild(renderTile(d)));
    }

    function wireSearch(){
      const box = document.getElementById('searchBox');
      const btn = document.getElementById('searchBtn');
      const doSearch = () => renderStrip2Tiles(box.value);
      btn.addEventListener('click', doSearch);
      box.addEventListener('keydown', (e) => { if (e.key === 'Enter') { e.preventDefault(); doSearch(); }});
    }
  </script>
</body>
</html>
