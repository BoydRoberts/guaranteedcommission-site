<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>GuaranteedCommission.com</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{
      /* micro-tuning knobs */
      --title-bottom-gap: .75rem;         /* controls spacing under all three titles */
      --box2-first-input-offset: 1rem;    /* lowers Box 2 first input ~1 line */
    }

    .font-cursive { font-family: 'Brush Script MT', cursive; }

    /* Nav hover */
    .group { position: relative; }
    #commissionMenu { display: none; position: absolute; left: 0; top: 100%; }
    .group:hover #commissionMenu,
    .group:focus-within #commissionMenu,
    .group.nav-open #commissionMenu { display: block; }

    /* --- Strip 2 tile styles --- */
    .gc-tile { background:#fff; border-radius:0.75rem; overflow:hidden; box-shadow:0 1px 6px rgba(0,0,0,.08); }
    .gc-photo { width:100%; height:180px; object-fit:cover; background:#e5e7eb; }
    .gc-ribbon { position:absolute; top:10px; left:10px; background:rgba(0,0,0,.75); color:#fff; font-size:12px; padding:4px 8px; border-radius:6px; }

    /* --- Strip 1: same-size boxes (Box 1 = baseline), no scrollbars --- */
    #box1, #formBlock, #box3 { overflow: hidden; } /* avoid scrollbars */
    .gc-title { text-align:center; font-weight:700; font-size:1.125rem; line-height:1.25; margin:0 0 var(--title-bottom-gap); }

    /* Lower Box 2 form by ~1 line */
    .gc-form-offset { margin-top: var(--box2-first-input-offset); }

    /* Real-Reflow compact tiers for Box 2 (form) */
    #formBlock.compact * { line-height:1.25; }
    #formBlock.compact h2.gc-title { font-size:1.05rem; }
    #formBlock.compact input, #formBlock.compact select, #formBlock.compact button { padding:.3rem .45rem !important; font-size:.85rem !important; }
    #formBlock.compact .space-y-2 > * { margin-top:.25rem !important; margin-bottom:.25rem !important; }

    #formBlock.compact2 * { line-height:1.2; }
    #formBlock.compact2 h2.gc-title { font-size:1.0rem; }
    #formBlock.compact2 input, #formBlock.compact2 select, #formBlock.compact2 button { padding:.25rem .4rem !important; font-size:.8rem !important; }
    #formBlock.compact2 .space-y-2 > * { margin-top:.2rem !important; margin-bottom:.2rem !important; }

    #formBlock.compact3 * { line-height:1.15; }
    #formBlock.compact3 h2.gc-title { font-size:.95rem; }
    #formBlock.compact3 input, #formBlock.compact3 select, #formBlock.compact3 button { padding:.22rem .35rem !important; font-size:.75rem !important; }
    #formBlock.compact3 .space-y-2 > * { margin-top:.18rem !important; margin-bottom:.18rem !important; }

    /* Real-Reflow compact tiers for Box 3 (ISC) – keep text razor sharp */
    #box3.compact * { line-height:1.35; }
    #box3.compact p { font-size:.95rem; }
    #box3.compact2 * { line-height:1.3; }
    #box3.compact2 p { font-size:.9rem; }
    #box3.compact3 * { line-height:1.25; }
    #box3.compact3 p { font-size:.85rem; }
  </style>
</head>
<body class="bg-gray-100 text-gray-800">
  <!-- Header -->
  <header class="bg-white shadow">
    <div class="flex justify-between items-center max-w-7xl mx-auto px-4 py-4">
      <button onclick="openInvestorModal()" class="bg-red-600 text-white text-xs font-semibold px-3 py-1 rounded">
        Accredited Investors Only
      </button>
      <div class="text-center flex-1">
        <!-- Logo + Site Name -->
        <div class="flex items-center justify-center gap-1">
          <img src="/Logo.png" alt="GuaranteedCommission Logo" class="h-8 w-8 object-contain">
          <h1 class="text-3xl font-bold">GuaranteedCommission.com</h1>
        </div>
        <!-- Tagline -->
        <p class="text-sm text-red-600 mt-1 px-2">
          Guaranteeing commissions so your home will sell quickly at a higher price.
        </p>
      </div>
      <div class="flex items-center gap-2">
        <a href="/local-professionals.html" class="bg-amber-600 text-white text-xs font-semibold px-3 py-1 rounded">Local Professionals</a>
        <!-- Removed header Log In button per request -->
      </div>
    </div>
  </header>

  <!-- Press Modal -->
  <div id="pressModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
    <div class="bg-white rounded-lg shadow-lg p-6 w-96 relative">
      <button onclick="closePressModal()" class="absolute top-2 right-2 text-xl font-bold">&times;</button>
      <h2 class="text-lg font-bold mb-4">Press Inquiry Form</h2>
      <input type="text" id="pressName" placeholder="Full Name" class="w-full border p-1 mb-2 rounded">
      <input type="text" id="pressOrg" placeholder="Organization" class="w-full border p-1 mb-2 rounded">
      <input type="tel" id="pressPhone" placeholder="Phone" class="w-full border p-1 mb-2 rounded">
      <input type="email" id="pressEmail" placeholder="Email Address" class="w-full border p-1 mb-4 rounded">
      <button onclick="submitPressForm()" class="w-full bg-blue-600 text-white py-2 rounded">Submit</button>
      <p id="pressConfirmation" class="mt-4 text-green-600 font-semibold text-center hidden">We will be in touch.</p>
    </div>
  </div>

  <!-- Nav -->
  <nav class="bg-gray-200 py-2">
    <ul class="flex justify-center space-x-8 font-semibold">
      <li class="group">
        <span class="hover:underline cursor-pointer" tabindex="0" id="commissionToggle">Communicate Guaranteed Commission</span>
        <ul id="commissionMenu" class="mt-2 w-64 bg-white border shadow text-sm text-gray-700 z-10">
          <li><a href="#" onclick="selectPlan('Listed Property Basic')" class="block px-4 py-2 hover:bg-gray-100">Listed Property Basic</a></li>
          <li><a href="#" onclick="selectPlan('Listed Property Plus')" class="block px-4 py-2 hover:bg-gray-100">Listed Property Plus</a></li>
          <li><a href="#" onclick="selectPlan('FSBO Plus')" class="block px-4 py-2 hover:bg-gray-100">FSBO Plus</a></li>
        </ul>
      </li>
      <li><a href="#strip2Search" class="hover:underline">Search Guaranteed Commission</a></li>
      <li><a href="/login.html" class="hover:underline">Log In</a></li>
    </ul>
  </nav>

  <!-- Strip 1 (full-bleed #4DA6FF background) -->
  <div style="background-color:#4DA6FF;">
    <section class="flex flex-col md:flex-row justify-center items-start gap-6 px-4 py-8 max-w-7xl mx-auto">
      <!-- Box 1 (baseline) -->
      <div id="box1" class="w-full md:w-1/3 bg-white p-4 rounded shadow text-sm">
        <h2 class="gc-title">Commission Communication Menu</h2>
        <ul class="space-y-3">
          <li>
            <div onclick="selectPlan('Listed Property Basic')" class="cursor-pointer">
              <p class="text-base font-semibold">Listed Property Basic | <span class="text-red-600">FREE</span></p>
              <p class="text-gray-600 pl-5">Printable commission letter, map search, listing price, main photo, address, square footage, bedrooms, bathrooms, listing brokerage, listing agent, listing agent phone number.</p>
            </div>
          </li>
          <li>
            <div onclick="selectPlan('Listed Property Plus')" class="cursor-pointer">
              <p class="text-base font-semibold">Listed Property Plus | $20</p>
              <p class="text-gray-600 pl-5">Listed Property Basic plus 20 photos and full property description.</p>
            </div>
          </li>
          <li>
            <div onclick="selectPlan('FSBO Plus')" class="cursor-pointer">
              <p class="text-base font-semibold">FSBO Plus | $100</p>
              <p class="text-gray-600 pl-5">Listed Property Plus minus the listing agency. Includes showing instructions.</p>
            </div>
          </li>
        </ul>
      </div>

      <!-- Box 2 (form) -->
      <div id="formBlock" class="w-full md:w-1/3 bg-white p-4 rounded shadow text-sm">
        <h2 id="formTitle" class="gc-title">Listed Property Communication Form</h2>
        <form id="listingForm" class="gc-form-offset space-y-2" autocomplete="off">
          <input type="text" id="name" placeholder="Name" class="w-full border p-1 rounded" required>

          <!-- Address -->
          <input type="text" id="address" placeholder="Address format: Street, City, ST 12345" class="w-full border p-1 rounded" autocomplete="street-address" spellcheck="false" required >

          <!-- Parcel -->
          <input type="text" id="apn" placeholder="Parcel # / Pin # / Tax ID # / Folio # / APN #" class="w-full border p-1 rounded">

          <!-- Phone/Broker/Agent -->
          <div id="listedPhoneRow">
            <input type="tel" id="agentPhone" placeholder="Agent’s direct phone only – NOT your number" class="w-full border p-1 rounded">
            <span id="phoneError" class="text-xs text-red-600 hidden">Please enter a valid phone number (###) ###-####</span>
          </div>

          <!-- Agent Email (NEW) -->
          <input type="email" id="agentEmail" placeholder="Agent’s Email – NOT your email" class="w-full border p-1 rounded">

          <!-- Brokerage (HIDDEN for FSBO) -->
          <input type="text" id="brokerage" placeholder="Listing Brokerage" class="w-full border p-1 rounded">

          <!-- Agent (HIDDEN for FSBO) -->
          <input type="text" id="agent" placeholder="Listing Agent" class="w-full border p-1 rounded">

          <!-- FSBO-only contact -->
          <div id="fsboEmailRow" class="hidden">
            <input type="email" id="fsboEmailInput" placeholder="Owner/Seller email" class="w-full border p-1 rounded">
          </div>

          <!-- Commission -->
          <div class="flex gap-2">
            <input type="text" id="commission" placeholder="Buyer Agent Commission" class="w-full border p-1 rounded">
            <select id="commissionType" class="border p-1 rounded">
              <option value="%">%</option>
              <option value="$">$</option>
            </select>
          </div>

          <button type="button" onclick="submitForm()" class="w-full bg-green-600 text-white py-2 rounded mt-2">
            Submit Guaranteed Commission
          </button>
        </form>
      </div>

      <!-- Box 3 (ISC) -->
      <div id="box3" class="w-full md:w-1/3 bg-white p-4 rounded shadow text-sm">
        <h2 class="gc-title">Irrevocable Seller Communication</h2>

        <!-- LISTED ISC -->
        <div id="iscTextListed">
          <p>To the escrow holder/closing agent,</p>
          <p class="mt-2">
            I, <span id="letterName">[name]</span>, am the owner/seller of
            <span id="letterAddressFull">[full address]</span>,
            # <span id="letterAPN">[Parcel # / Pin # / Tax ID # / Folio # / APN #]</span>.
            <span id="letterAddressShort1">[short address]</span> is listed for sale by
            <span id="letterBrokerage">[listing brokerage]</span>, <span id="letterAgent">[listing agent]</span>, listing agent,
            <span id="letterAgentPhone">[agent phone]</span>, <span id="letterAgentEmail">[agent email]</span>.
          </p>
          <p class="mt-2">
            Let it be known: if a buyer’s agent/broker facilitates the sale of
            <span id="letterAddressShort2">[short address]</span>, you (the escrow holder/closing agent) are irrevocably instructed
            to credit/compensate the buyer’s broker – first, by debiting the listing brokerage (if there is an agreement for
            broker-to-broker compensation) and second by debiting me, the seller – a commission not to exceed
            <span id="letterCommissionDisplay">[commission]</span> <span id="commissionSuffix"></span>.
          </p>
          <p class="mt-4"><span id="signatureName" class="pl-5 font-cursive">[Name]</span> Electronic Signature      date</p>
        </div>

        <!-- FSBO ISC -->
        <div id="iscTextFSBO" class="hidden">
          <p>To the escrow holder/closing agent,</p>
          <p class="mt-2">
            I, <span id="letterNameFSBO">[name]</span>, am the owner/seller of
            <span id="letterAddressFullFSBO">[full address]</span>, #
            <span id="letterAPNFSBO">[Parcel # / Pin # / Tax ID # / Folio # / APN #]</span>.
            <span id="letterAddressShort1FSBO">[short address]</span> is listed for sale by owner (Me).
            My phone number is <span id="fsboPhone"></span>. My email address is <span id="fsboEmail"></span>.
          </p>
          <p class="mt-2">
            Let it be known: if a buyer’s agent/broker facilitates the sale of
            <span id="letterAddressShort2FSBO">[short address]</span>, you (the escrow holder/closing agent) are irrevocably
            instructed to credit/compensate the buyer’s broker a commission not to exceed
            <span id="letterCommissionDisplayFSBO">[commission]</span> <span id="commissionSuffixFSBO"></span>.
          </p>
          <p class="mt-4"><span id="signatureNameFSBO" class="pl-5 font-cursive">[Name]</span> Electronic Signature      date</p>
        </div>
      </div>
    </section>
  </div>

  <!-- Strip 2: Search / Tiles (full-bleed white + extra spacing) -->
  <div style="background-color:#ffffff;">
    <section id="strip2Search" class="max-w-7xl mx-auto px-4 pb-12">
      <!-- Centered search header, nudged down ~1/4 inch -->
      <div class="text-center mb-4 mt-6">
        <div class="flex items-center justify-center">
          <div class="flex items-center gap-2">
            <input id="searchBox" type="text" placeholder="Search city, neighborhood, or ZIP…" class="border rounded px-3 py-2 w-72 sm:w-96">
            <button id="searchBtn" class="bg-blue-600 text-white px-3 py-2 rounded">Search Guaranteed Commissions</button>
          </div>
        </div>
      </div>

      <!-- Tiles grid, nudged down ~1/4 inch -->
      <div id="tileGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5 mt-6"></div>
    </section>
  </div>

  <!-- Footer (Press button restored) -->
  <footer class="bg-white border-t mt-8">
    <div class="max-w-7xl mx-auto px-4 py-6 text-center text-xs text-gray-600 space-y-3">
      <button onclick="openPressModal()" class="bg-blue-600 text-white text-xs font-semibold px-3 py-2 rounded">
        Press Inquiry
      </button>
      <p>© 2025 GuaranteedCommission.com. All rights reserved.</p>
      <p>Boyd Roberts · California Licensed Real Estate Broker · DRE License #01354788</p>
      <p>
        <a href="/privacy.html" class="hover:underline">Privacy Policy</a> · 
        <a href="/terms.html" class="hover:underline">Terms of Use</a>
      </p>
      <p class="text-[10px] text-gray-400">This platform is a Commission Communication Platform. All purchases subject to quality control review.</p>
    </div>
  </footer>

  <!-- Scripts -->
  <script>
    /* Header modals */
    function openInvestorModal(){ document.getElementById('investorModal').classList.remove('hidden'); }
    function closeInvestorModal(){ document.getElementById('investorModal').classList.add('hidden'); }
    function openPressModal(){ document.getElementById('pressModal').classList.remove('hidden'); }
    function closePressModal(){ document.getElementById('pressModal').classList.add('hidden'); }
    function submitPressForm(){ document.getElementById('pressConfirmation').classList.remove('hidden'); }

    // Keep commission menu open while hovering submenu (robust hover)
    (function(){
      const li = document.querySelector('.group');
      const menu = document.getElementById('commissionMenu');
      if (!li || !menu) return;
      let t;
      function open(){ li.classList.add('nav-open'); clearTimeout(t); }
      function close(){ t = setTimeout(()=>li.classList.remove('nav-open'), 120); }
      li.addEventListener('mouseenter', open);
      li.addEventListener('mouseleave', close);
      menu.addEventListener('mouseenter', open);
      menu.addEventListener('mouseleave', close);
      document.getElementById('commissionToggle')?.addEventListener('focus', open);
      document.getElementById('commissionToggle')?.addEventListener('blur', close);
    })();

    // Address validator
    function isValidFullAddress(s) {
      if (!s) return false;
      const re = /^\s*.+?,\s*[A-Za-z .'\-]+,\s*[A-Za-z]{2}\s+\d{5}(?:-\d{4})?\s*$/;
      return re.test(s.trim());
    }

    /* Plan switcher */
    function selectPlan(planName){
      localStorage.setItem("selectedPlan", planName);
      showForm(planName === "FSBO Plus" ? "fsbo" : (planName === "Listed Property Plus" ? "plus" : "listed"));
      // Refit after plan change
      setTimeout(fitStrip1, 0);
      setTimeout(fitStrip1, 120);
    }

    /* Toggle form + ISC */
    function showForm(type){
      const title = document.getElementById("formTitle");
      const phoneInput = document.getElementById('agentPhone');
      const brokerageInput = document.getElementById('brokerage');
      const agentInput = document.getElementById('agent');
      const agentEmailInput = document.getElementById('agentEmail');
      const fsboEmailRow = document.getElementById('fsboEmailRow');
      const listedPhoneRow = document.getElementById('listedPhoneRow');

      if(type === 'fsbo'){
        title.textContent = 'FSBO Communication Form';
        listedPhoneRow.classList.remove('hidden');
        phoneInput.placeholder = 'Owner/Seller phone number';
        brokerageInput.style.display = 'none';
        agentInput.style.display = 'none';
        agentEmailInput.style.display = 'none';
        fsboEmailRow.classList.remove('hidden');

        document.getElementById('iscTextListed').classList.add('hidden');
        document.getElementById('iscTextFSBO').classList.remove('hidden');
      } else {
        title.textContent = (type === 'plus' ? 'Listed Property Plus Communication Form' : 'Listed Property Communication Form');
        listedPhoneRow.classList.remove('hidden');
        phoneInput.placeholder = 'Agent’s direct phone only – NOT your number';
        brokerageInput.style.display = 'block';
        agentInput.style.display = 'block';
        agentEmailInput.style.display = 'block';
        fsboEmailRow.classList.add('hidden');

        document.getElementById('iscTextListed').classList.remove('hidden');
        document.getElementById('iscTextFSBO').classList.add('hidden');
      }
    }

    // Fit Strip 1: lock Box 1 height, compact Box 2 & 3 tiers (no scrollbars, crisp text)
    function fitStrip1(){
      const b1 = document.getElementById('box1');
      const b2 = document.getElementById('formBlock');
      const b3 = document.getElementById('box3');
      if (!b1 || !b2 || !b3) return;

      // Reset to measure baseline properly
      [b1, b2, b3].forEach(b => b.style.height='auto');
      b2.classList.remove('compact','compact2','compact3');
      b3.classList.remove('compact','compact2','compact3');

      // 1) Lock to Box 1 height
      const baseline = b1.getBoundingClientRect().height || b1.clientHeight;
      [b1, b2, b3].forEach(b => b.style.height = baseline + 'px');

      // 2) Compact tiers function
      function ensureFits(el){
        const tiers = ['compact','compact2','compact3'];
        for (let i=0;i<tiers.length;i++){
          if (el.scrollHeight <= el.clientHeight + 1) return; // already fits
          el.classList.add(tiers[i]);
        }
      }
      ensureFits(b2); // Box 2 (form)
      ensureFits(b3); // Box 3 (ISC)

      // If super edge case still a pixel off after class changes, try a second pass
      setTimeout(()=>{
        ensureFits(b2);
        ensureFits(b3);
      },0);
    }

    /* On load */
    window.addEventListener('DOMContentLoaded', () => {
      const lastSelected = localStorage.getItem('selectedPlan') || 'Listed Property Basic';
      showForm('listed');
      localStorage.setItem('selectedPlan', lastSelected.includes('FSBO') ? 'Listed Property Basic' : lastSelected);

      // Phone mask: (###) ###-####
      const phoneInput = document.getElementById('agentPhone');
      const phoneError = document.getElementById('phoneError');
      phoneInput?.addEventListener('input', function(){
        let d = this.value.replace(/\D/g,'').slice(0,10);
        let v = d;
        if (d.length > 6) v = `(${d.slice(0,3)}) ${d.slice(3,6)}-${d.slice(6)}`;
        else if (d.length > 3) v = `(${d.slice(0,3)}) ${d.slice(3)}`;
        this.value = v;
        const ok = /^\(\d{3}\)\s\d{3}-\d{4}$/.test(this.value);
        phoneInput.classList.toggle('border-red-500', !ok && d.length===10);
        phoneError.classList.toggle('hidden', ok || d.length<10);
        syncAll();
        fitStrip1();
      });

      // Refit on any input impacting content height
      ['name','address','apn','brokerage','agent','agentPhone','agentEmail','commission','commissionType']
        .forEach(id=>{
          const el=document.getElementById(id);
          if(!el) return;
          el.addEventListener('input', ()=>{ syncAll(); fitStrip1(); });
          el.addEventListener('change', ()=>{ syncAll(); fitStrip1(); });
        });

      function syncAll(){
        const fullAddr = (document.getElementById('address').value || '').trim();
        const short = fullAddr.split(',')[0] || '';
        const nameVal = document.getElementById('name').value || '';
        const apnVal = document.getElementById('apn').value || '';
        const phoneVal = document.getElementById('agentPhone').value || '';
        const brokerageVal = document.getElementById('brokerage').value || '';
        const agentVal = document.getElementById('agent').value || '';
        const agentEmailVal = document.getElementById('agentEmail').value || '';
        const fsboEmailInput = document.getElementById('fsboEmailInput');
        const amount = (document.getElementById('commission').value || '').trim();
        const type = document.getElementById('commissionType').value;
        const suffix = type === '%' ? 'of the total purchase price' : '';
        const display = type === '$' ? (amount ? ('$' + Number(amount).toLocaleString()) : '') : (amount ? amount + '%' : '');

        // Listed
        document.getElementById('letterName').textContent = nameVal || '[name]';
        document.getElementById('letterAddressFull').textContent = fullAddr || '[full address]';
        document.getElementById('letterAPN').textContent = apnVal || '[Parcel # / Pin # / Tax ID # / Folio # / APN #]';
        document.getElementById('letterAddressShort1').textContent = short || '[short address]';
        document.getElementById('letterAddressShort2').textContent = short || '[short address]';
        document.getElementById('letterBrokerage').textContent = brokerageVal || '[listing brokerage]';
        document.getElementById('letterAgent').textContent = agentVal || '[listing agent]';
        document.getElementById('letterAgentPhone').textContent = phoneVal || '[agent phone]';
        document.getElementById('letterAgentEmail').textContent = agentEmailVal || '[agent email]';
        document.getElementById('letterCommissionDisplay').textContent = display || '[commission]';
        document.getElementById('commissionSuffix').textContent = display ? (' ' + suffix) : '';
        document.getElementById('signatureName').textContent = nameVal || '[Name]';

        // FSBO
        document.getElementById('letterNameFSBO').textContent = nameVal || '[name]';
        document.getElementById('letterAddressFullFSBO').textContent = fullAddr || '[full address]';
        document.getElementById('letterAddressShort1FSBO').textContent = short || '[short address]';
        document.getElementById('letterAddressShort2FSBO').textContent = short || '[short address]';
        document.getElementById('letterAPNFSBO').textContent = apnVal || '[Parcel # / Pin # / Tax ID # / Folio # / APN #]';
        document.getElementById('fsboPhone').textContent = phoneVal || '[owner/seller phone number]';
        document.getElementById('fsboEmail').textContent = (fsboEmailInput && fsboEmailInput.value) || '[owner/seller email]';
        document.getElementById('letterCommissionDisplayFSBO').textContent = display || '[commission]';
        document.getElementById('commissionSuffixFSBO').textContent = display ? (' ' + suffix) : '';
        document.getElementById('signatureNameFSBO').textContent = nameVal || '[Name]';
      }
      syncAll();

      // ---- Strip 2 tiles + search ----
      buildTilesDataset();
      renderStrip2Tiles(localStorage.getItem('lastSearch') || '');
      wireSearch();

      // Initial fit and on resize
      fitStrip1();
      setTimeout(fitStrip1, 150);
      window.addEventListener('resize', fitStrip1);
    });

    /* Submit */
    function submitForm(){
      const isFSBO = document.getElementById('formTitle').textContent.includes('FSBO');
      const requiredIds = ['name','address','agentPhone'];
      if (isFSBO) requiredIds.push('apn','fsboEmailInput');
      let ok=true;
      for(const id of requiredIds){
        const el=document.getElementById(id);
        if(!el||!el.value.trim()){ if(el) el.classList.add('border-red-500'); ok=false; }
        else el.classList.remove('border-red-500');
      }
      if(!ok){ alert('Please complete all required fields.'); return; }

      const addressEl=document.getElementById('address');
      const addrVal=(addressEl.value||'').trim();
      if(!isValidFullAddress(addrVal)){
        addressEl.classList.add('border-red-500');
        alert('Please use full address format: Street, City, ST 12345');
        return;
      } else addressEl.classList.remove('border-red-500');

      const fsboEmailEl=document.getElementById('fsboEmailInput');
      const formData={
        name:document.getElementById('name').value.trim(),
        address:addrVal,
        apn:document.getElementById('apn').value.trim(),
        commission:document.getElementById('commission').value.trim(),
        commissionType:document.getElementById('commissionType').value,
        phone:document.getElementById('agentPhone').value.trim(),
        brokerage:document.getElementById('brokerage').value.trim(),
        agent:document.getElementById('agent').value.trim(),
        agentEmail:document.getElementById('agentEmail').value.trim(),
        fsboEmail:document.getElementById('fsboEmailInput')?.value.trim() || ''
      };
      localStorage.setItem("formData",JSON.stringify(formData));
      if(formData.address){
        const short=formData.address.split(',')[0];
        localStorage.setItem('shortAddress',short);
      }
      const plan=localStorage.getItem('selectedPlan')||'Listed Property Basic';
      localStorage.setItem('postSignatureOptions',plan.includes('FSBO')?'fsbo':'listed');
      localStorage.setItem('nextAfterLogin','/verify-code.html');
      window.location.href="/login.html";
    }

    // ---------- Strip 2 helpers ----------
    function fmtUSD(n){ const v=Number(n||0); return v?("$"+v.toLocaleString()):"$—"; }
    function commissionDollars(price, val, type){
      const p=Number(price||0), c=Number(val||0);
      if(!c) return null;
      if(type==='$') return Math.round(c);
      if(p) return Math.round(p*(c/100));
      return null;
    }
    function renderTile(data){
      const {
        address="[full address]",
        price,
        commission,
        commissionType="%",
        bannerText="",
        photos=[],
        primaryIndex=0,
        status="Active",
        brokerage="[listing brokerage]",
        agent="[listing agent]",
        plan="Listed Property Basic",
        bedrooms, bathrooms, sqft,
        propertyType,
        agentPhone
      } = data || {};

      const calc = commissionDollars(price, commission, commissionType);
      const line1Left  = fmtUSD(price);
      const line1Mid   = commission ? (commissionType==='%' ? `${commission}%` : `$${Number(commission).toLocaleString()}`) : '—';
      const line1Right = (calc!=null) ? `$${calc.toLocaleString()}` : '—';

      const img = (photos && photos.length ? photos[primaryIndex||0] : "");
      const typeSeg = propertyType ? ` | ${propertyType}` : '';
      const card = document.createElement('article');
      card.className = "gc-tile cursor-pointer";
      card.onclick = () => {
        const slug = encodeURIComponent(address);
        window.location.href = `/listing.html?addr=${slug}`;
      };

      card.innerHTML = `
        <div class="relative">
          <img class="gc-photo" src="${img || ''}" alt="Listing photo">
          ${bannerText ? `<div class="gc-ribbon">${bannerText}</div>` : ``}
        </div>
        <div class="p-3 space-y-1">
          <div class="flex items-center justify-between text-[15px] sm:text-[16px] font-semibold">
            <div class="truncate">${line1Left}</div>
            <div class="truncate text-red-600">Commission ${line1Mid} | ${line1Right}</div>
          </div>
          <div class="text-[12px] text-gray-700">
            ${bedrooms ?? '—'} bds | ${bathrooms ?? '—'} ba | ${sqft ? Number(sqft).toLocaleString() : '—'} sqft${typeSeg} | ${status}
          </div>
          <div class="text-sm font-medium">${address}</div>
          <div class="text-[12px] text-gray-600">
            ${((plan||'').includes('FSBO') ? 'FOR SALE BY OWNER' : (brokerage||'[listing brokerage]')).toUpperCase()}
            ${agent ? ' — '+agent : ''}${agentPhone ? ' — '+agentPhone : ''}
          </div>
        </div>
      `;
      return card;
    }

    let _tilesData = [];
    function buildTilesDataset(){
      _tilesData = [];
      const formData = JSON.parse(localStorage.getItem('formData') || '{}');
      const agentListing = JSON.parse(localStorage.getItem('agentListing') || '{}');
      const plan = (localStorage.getItem('selectedPlan') || 'Listed Property Basic').trim();

      const hasLive = formData && formData.address;
      if (hasLive) {
        _tilesData.push({
          address: formData.address,
          price: agentListing.price,
          commission: agentListing.commission ?? formData.commission,
          commissionType: agentListing.commissionType ?? formData.commissionType ?? '%',
          bannerText: agentListing.bannerText,
          photos: Array.isArray(agentListing.photos) ? agentListing.photos : [],
          primaryIndex: typeof agentListing.primaryIndex==='number' ? agentListing.primaryIndex : 0,
          status: agentListing.status || 'Active',
          brokerage: formData.brokerage,
          agent: formData.agent,
          agentPhone: document.getElementById('agentPhone')?.value || formData.phone || '',
          plan,
          bedrooms: agentListing.bedrooms,
          bathrooms: agentListing.bathrooms,
          sqft: agentListing.sqft,
          propertyType: agentListing.propertyType || ''
        });
      }

      // Samples for demo (with propertyType)
      const samples = [
        {
          address: "237 San Joaquin Street, Laguna Beach, CA 92651",
          price: 1895000, commission: 2.5, commissionType: '%',
          bannerText: "Open Sunday 1–4",
          photos: ["https://images.unsplash.com/photo-1560518883-ce09059eeffa?q=80&w=1200&auto=format&fit=crop"],
          primaryIndex: 0, status: "Active",
          brokerage: "Pacific Estates", agent: "Jordan Crisp",
          plan: "Listed Property Plus", bedrooms: 3, bathrooms: 2, sqft: 2000
        },
        {
          address: "14 Maple Ave, Montclair, NJ 07042",
          price: 925000, commission: 25000, commissionType: '$',
          photos: ["https://images.unsplash.com/photo-1570129477492-45c003edd2be?q=80&w=1200&auto=format&fit=crop"],
          primaryIndex: 0, status: "In Contract",
          brokerage: "HomeWorks Realty", agent: "A. Brooks",
          plan: "Listed Property Basic", bedrooms: 4, bathrooms: 3, sqft: 2400
        },
        {
          address: "1020 Cedar Dr, Austin, TX 78704",
          price: 650000, commission: 3.0, commissionType: '%',
          bannerText: "Hot Home",
          photos: ["https://images.unsplash.com/photo-1600585154526-990dced4db0d?q=80&w=1200&auto=format&fit=crop"],
          primaryIndex: 0, status: "Active",
          brokerage: "", agent: "",
          plan: "FSBO Plus", bedrooms: 3, bathrooms: 2, sqft: 1680
        }
      ];
      const haveAddr = new Set(_tilesData.map(d => (d.address||'').toLowerCase()));
      samples.forEach(s => { if(!haveAddr.has((s.address||'').toLowerCase())) _tilesData.push(s); });
    }

    function renderStrip2Tiles(filterText=""){
      const grid = document.getElementById('tileGrid');
      grid.innerHTML = '';
      const q = (filterText || '').toLowerCase();
      const list = q ? _tilesData.filter(d => (d.address||'').toLowerCase().includes(q)) : _tilesData;
      if (!list.length) {
        grid.innerHTML = `<div class="text-sm text-gray-500 text-center">No results. Try a different search.</div>`;
        return;
      }
      list.forEach(d => grid.appendChild(renderTile(d)));
    }

    function wireSearch(){
      const box = document.getElementById('searchBox');
      const btn = document.getElementById('searchBtn');
      const go = () => {
        const q = (box.value || '').trim();
        localStorage.setItem('lastSearch', q);
        if (!q) { renderStrip2Tiles(''); return; }
        window.location.href = `/search.html?q=${encodeURIComponent(q)}`;
      };
      btn.addEventListener('click', go);
      box.addEventListener('keydown', (e) => { if (e.key === 'Enter') { e.preventDefault(); go(); }});
    }
  </script>
</body>
</html>
