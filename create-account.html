<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Create Account | GuaranteedCommission.com</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .strength-0 { width: 0%; }
    .strength-1 { width: 25%; }
    .strength-2 { width: 50%; }
    .strength-3 { width: 75%; }
    .strength-4 { width: 100%; }
  </style>
</head>
<body class="bg-gray-100 text-gray-800">
  <div class="max-w-md mx-auto mt-10 bg-white p-6 rounded-2xl shadow">
    <h1 class="text-2xl font-bold text-center">Create Your Account</h1>
    <p class="text-center text-sm text-gray-500 mt-1">State-of-the-art security & verification</p>

    <form id="createForm" class="space-y-4 mt-6" autocomplete="off">
      <div>
        <label for="fullName" class="block text-sm font-semibold">Full name</label>
        <input id="fullName" type="text" class="w-full border rounded px-3 py-2 mt-1" placeholder="Jane Doe" required />
      </div>

      <div>
        <label for="email" class="block text-sm font-semibold">Email</label>
        <input id="email" type="email" class="w-full border rounded px-3 py-2 mt-1" placeholder="you@example.com" required />
      </div>

      <div>
        <label for="phone" class="block text-sm font-semibold">Phone</label>
        <input id="phone" type="tel" class="w-full border rounded px-3 py-2 mt-1" placeholder="123-456-7890" required />
        <p class="text-xs text-gray-500 mt-1">Format: 123-456-7890</p>
      </div>

      <div>
        <label class="block text-sm font-semibold">I am a</label>
        <select id="role" class="w-full border rounded px-3 py-2 mt-1" required>
          <option value="">Select role…</option>
          <option value="seller">Seller</option>
          <option value="agent">Listing Agent</option>
        </select>
      </div>

      <!-- Password -->
      <div>
        <label for="password" class="block text-sm font-semibold">Create password</label>
        <div class="relative mt-1">
          <input id="password" type="password" class="w-full border rounded px-3 py-2 pr-10" placeholder="At least 8 characters" required />
          <button type="button" id="togglePass" class="absolute right-2 top-1/2 -translate-y-1/2 text-xs text-blue-600">Show</button>
        </div>
        <div class="mt-2 h-2 bg-gray-200 rounded overflow-hidden">
          <div id="strengthBar" class="h-full bg-green-500 transition-all strength-0"></div>
        </div>
        <p id="strengthText" class="text-xs text-gray-600 mt-1">Strength: —</p>
        <ul class="text-xs text-gray-500 mt-2 list-disc list-inside">
          <li>At least 8 characters</li>
          <li>Include a number and a symbol</li>
          <li>Use upper & lower case letters</li>
        </ul>
      </div>

      <!-- Confirm -->
      <div>
        <label for="confirm" class="block text-sm font-semibold">Confirm password</label>
        <div class="relative mt-1">
          <input id="confirm" type="password" class="w-full border rounded px-3 py-2 pr-10" placeholder="Re-enter your password" required />
          <button type="button" id="toggleConfirm" class="absolute right-2 top-1/2 -translate-y-1/2 text-xs text-blue-600">Show</button>
        </div>
        <p id="matchMsg" class="text-xs mt-1"></p>
      </div>

      <p class="text-xs text-gray-500">
        GuaranteedCommission.com only uses your information for escrow and identification.
        Your information will not be sold to third parties or used for solicitation purposes.
      </p>

      <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded font-semibold">
        Create Account & Send Code
      </button>
    </form>

    <p class="text-sm text-center mt-6">
      Already have an account?
      <a href="/login.html" class="text-blue-600 hover:underline">Log in</a>
    </p>
  </div>

  <script>
    // Prefill from formData if present
    (function prefill(){
      try{
        const data = JSON.parse(localStorage.getItem("formData") || "{}");
        if(data.name) document.getElementById("fullName").value = data.name;
        if(data.phone) document.getElementById("phone").value = data.phone;
        if(data.brokerage && /@/.test(data.brokerage)) document.getElementById("email").value = data.brokerage;
      }catch(e){}
    })();

    // Phone mask
    const phoneEl = document.getElementById("phone");
    phoneEl.addEventListener("input", function(){
      let v = this.value.replace(/\D/g,'');
      if(v.length>3 && v.length<=6) v = v.replace(/(\\d{3})(\\d+)/,'$1-$2');
      else if(v.length>6) v = v.replace(/(\\d{3})(\\d{3})(\\d+)/,'$1-$2-$3');
      this.value = v;
    });

    // Show/hide password
    const pw = document.getElementById("password");
    const cf = document.getElementById("confirm");
    document.getElementById("togglePass").addEventListener("click", () => {
      pw.type = pw.type === "password" ? "text" : "password";
      event.target.textContent = pw.type === "password" ? "Show" : "Hide";
    });
    document.getElementById("toggleConfirm").addEventListener("click", () => {
      cf.type = cf.type === "password" ? "text" : "password";
      event.target.textContent = cf.type === "password" ? "Show" : "Hide";
    });

    // Strength meter
    const strengthBar = document.getElementById("strengthBar");
    const strengthText = document.getElementById("strengthText");
    function scorePassword(s){
      let score = 0;
      if(s.length >= 8) score++;
      if(/[0-9]/.test(s)) score++;
      if(/[!@#$%^&*(),.?":{}|<>\\[\\]\\/\\\\_\\-]/.test(s)) score++;
      if(/[a-z]/.test(s) && /[A-Z]/.test(s)) score++;
      return score; // 0..4
    }
    pw.addEventListener("input", () => {
      const sc = scorePassword(pw.value);
      strengthBar.className = "h-full bg-green-500 transition-all strength-" + sc;
      strengthText.textContent = "Strength: " + (["—","Weak","Fair","Good","Strong"][sc]);
    });

    // Confirm match
    const matchMsg = document.getElementById("matchMsg");
    function checkMatch(){
      if(!cf.value){ matchMsg.textContent = ""; return; }
      const ok = pw.value && cf.value && pw.value === cf.value;
      matchMsg.textContent = ok ? "Passwords match" : "Passwords do not match";
      matchMsg.className = "text-xs mt-1 " + (ok ? "text-green-600" : "text-red-600");
      return ok;
    }
    cf.addEventListener("input", checkMatch);

    // Submit
    document.getElementById("createForm").addEventListener("submit", (e) => {
      e.preventDefault();
      // basic validation
      const name = document.getElementById("fullName").value.trim();
      const email = document.getElementById("email").value.trim();
      const phone = document.getElementById("phone").value.trim();
      const role = document.getElementById("role").value;
      const pass = pw.value;
      const conf = cf.value;

      if(!name || !email || !phone || !role || !pass || !conf){
        alert("Please complete all fields.");
        return;
      }
      if(scorePassword(pass) < 3){
        alert("Please choose a stronger password (Good or Strong).");
        return;
      }
      if(pass !== conf){
        alert("Passwords do not match.");
        return;
      }

      // Save account data (simulated)
      const acct = { name, email, phone, role, password: pass };
      localStorage.setItem("accountData", JSON.stringify(acct));

      // Generate 6-digit code and store who to send it to
      const code = Math.floor(100000 + Math.random()*900000).toString();
      localStorage.setItem("verificationCode", code);
      localStorage.setItem("verifyMethod", "email"); // default; verify-code page lets them switch if needed
      localStorage.setItem("verifyTarget", email);

      // For testing, log it:
      console.log("[TEST] Verification code:", code, "→", email);

      // Go enter code
      window.location.href = "/verify-code.html";
    });
  </script>
</body>
</html>
