<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Irrevocable Seller Communication — Review & Sign</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .font-cursive { font-family: 'Brush Script MT', cursive; }
    @media print { .no-print { display:none !important; } }
  </style>
</head>
<body class="bg-gray-100 text-gray-900">
  <header class="bg-white border-b no-print">
    <div class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
      <a href="/checkout.html" class="text-sm text-blue-600 hover:underline">&larr; Back</a>
      <div class="text-center">
        <h1 class="text-lg font-semibold">GuaranteedCommission.com</h1>
        <p class="text-xs text-gray-600">Guaranteeing commissions so your home will sell quickly at a higher price.</p>
      </div>
      <a href="/login.html" class="text-sm text-blue-600 hover:underline">Log in</a>
    </div>
  </header>

  <main class="max-w-3xl mx-auto px-4 py-6">
    <section class="bg-white rounded-2xl shadow p-6">
      <h2 class="text-xl font-bold text-center">Irrevocable Seller Communication</h2>
      <p class="text-xs text-gray-500 text-center mb-6">Please review and sign below.</p>

      <!-- ISC body -->
      <div class="text-sm leading-6 text-gray-800" id="iscBody">
        <p>To the escrow holder/closing agent,</p>

        <!-- Listed -->
        <div id="iscListed" class="hidden">
          <p class="mt-3">
            I, <span id="L_name">[name]</span>, am the owner/seller of
            <span id="L_addrFull">[full address]</span><span id="L_parcelBlock">, # <span id="L_apn">[APN]</span></span>.
            <span id="L_addrShort1">[short address]</span> is listed for sale by
            <span id="L_brokerage">[listing brokerage]</span>,
            <span id="L_agent">[listing agent]</span>, listing agent,
            <span id="L_agentPhone">[agent phone]</span>.
          </p>
          <p class="mt-3">
            Let it be known: if a buyer’s agent/broker facilitates the sale of
            <span id="L_addrShort2">[short address]</span>, you (the escrow holder/closing agent)
            are irrevocably instructed to credit/compensate the buyer’s broker – first, by debiting the
            listing brokerage (if there is an agreement for broker-to-broker compensation) and second by
            debiting me, the seller – a commission not to exceed
            <span id="L_commDisplay">[commission]</span>
            <span id="L_commSuffix"></span>.
          </p>
        </div>

        <!-- FSBO -->
        <div id="iscFSBO" class="hidden">
          <p class="mt-3">
            I, <span id="F_name">[name]</span>, am the owner/seller of
            <span id="F_addrFull">[full address]</span><span id="F_parcelBlock">, # <span id="F_apn">[APN]</span></span>.
            <span id="F_addrShort1">[short address]</span> is listed for sale by owner (Me).
            My phone number is <span id="F_phone">[owner/seller phone]</span>. My email address is <span id="F_email">[owner/seller email]</span>.
          </p>
          <p class="mt-3">
            Let it be known: if a buyer’s agent/broker facilitates the sale of
            <span id="F_addrShort2">[short address]</span>, you (the escrow holder/closing agent)
            are irrevocably instructed to credit/compensate the buyer’s broker a commission not to exceed
            <span id="F_commDisplay">[commission]</span>
            <span id="F_commSuffix"></span>.
          </p>
        </div>
      </div>

      <!-- Sign block -->
      <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-semibold mb-1">Type Your Full Name (Signature)</label>
          <input id="sigName" class="w-full border p-2 rounded" placeholder="First Last"/>
          <p class="text-xs text-gray-500 mt-1">This will be rendered as an electronic signature.</p>
        </div>
        <div>
          <label class="block text-sm font-semibold mb-1">Date</label>
          <input id="sigDate" type="date" class="w-full border p-2 rounded"/>
        </div>
      </div>

      <div class="mt-6 flex items-center justify-between">
        <div class="text-base">
          <span id="sigPreview" class="font-cursive">[Name]</span>
          <span class="text-xs text-gray-600 ml-2 align-middle">Electronic Signature</span>
        </div>
        <div class="text-sm"><span id="sigPreviewDate">[YYYY-MM-DD]</span></div>
      </div>

      <!-- Actions (download/print removed; single primary CTA) -->
      <div class="no-print mt-8 flex items-center justify-end gap-2">
        <button id="btnContinue" class="px-6 py-2 rounded bg-green-600 text-white hover:bg-green-700">Sign &amp; Continue</button>
      </div>

      <p class="text-[11px] text-gray-500 text-center mt-4">
        GuaranteedCommission.com uses your information for escrow and identification only.
      </p>
    </section>
  </main>

  <script>
    console.log('[signature] build 2025-08-21a');

    const $ = (id) => document.getElementById(id);
    const getJSON = (k, fb) => { try { return JSON.parse(localStorage.getItem(k)) ?? fb; } catch { return fb; } };

    const plan = (localStorage.getItem("selectedPlan") || "Listed Property Basic").trim();
    const fd = getJSON("formData", {});
    const short = (fd.address || '').split(',')[0] || '[short address]';
    const apn  = (fd.apn || '').trim();

    // agent phone autofill fix: use fd.agentPhone first, then fd.phone
    const listedPhone = fd.agentPhone || fd.phone || "[agent phone]";
    const fsboPhone   = fd.phone || fd.agentPhone || "[owner/seller phone]";

    const amount = (fd.commission || '').trim();
    const type = fd.commissionType || '%';
    const suffix = type === '%' ? ' of the total purchase price' : '';
    const display = amount ? (type === '$' ? ('$' + Number(amount).toLocaleString()) : (amount + '%')) : '';

    const isFSBO = plan === "FSBO Plus";
    if (isFSBO) {
      $("iscFSBO").classList.remove("hidden");
      $("F_name").textContent = fd.name || "[name]";
      $("F_addrFull").textContent = fd.address || "[full address]";
      $("F_apn").textContent = apn || "[APN]";
      $("F_parcelBlock").style.display = apn ? "inline" : "none";
      $("F_addrShort1").textContent = short;
      $("F_addrShort2").textContent = short;
      $("F_phone").textContent = fsboPhone;
      $("F_email").textContent = fd.fsboEmail || "[owner/seller email]";
      $("F_commDisplay").textContent = display || "[commission]";
      $("F_commSuffix").textContent = display ? suffix : "";
    } else {
      $("iscListed").classList.remove("hidden");
      $("L_name").textContent = fd.name || "[name]";
      $("L_addrFull").textContent = fd.address || "[full address]";
      $("L_apn").textContent = apn || "[APN]";
      $("L_parcelBlock").style.display = apn ? "inline" : "none";
      $("L_addrShort1").textContent = short;
      $("L_addrShort2").textContent = short;
      $("L_brokerage").textContent = fd.brokerage || "[listing brokerage]";
      $("L_agent").textContent = fd.agent || "[listing agent]";
      $("L_agentPhone").textContent = listedPhone;
      $("L_commDisplay").textContent = display || "[commission]";
      $("L_commSuffix").textContent = display ? suffix : "";
    }

    // Signature defaults
    const today = new Date().toISOString().slice(0,10);
    $("sigDate").value = today;
    $("sigPreviewDate").textContent = today;

    $("sigName").addEventListener("input", () => {
      $("sigPreview").textContent = $("sigName").value || "[Name]";
    });
    $("sigDate").addEventListener("change", () => {
      $("sigPreviewDate").textContent = $("sigDate").value || today;
    });

    function saveSignature() {
      const name = $("sigName").value.trim();
      const date = $("sigDate").value || today;
      if (!name) { alert("Please type your full name to sign."); return false; }
      localStorage.setItem("signedISC", JSON.stringify({ name, date }));
      return true;
    }

    $("btnContinue").addEventListener("click", () => {
      if (!saveSignature()) return;
      // route: FSBO → seller-detail, Listed → agent-invite
      if (isFSBO) window.location.href = "/seller-detail.html";
      else window.location.href = "/agent-invite.html";
    });
  </script>
</body>
</html>
