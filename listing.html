<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Listing Detail | GuaranteedCommission.com</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Mapbox GL JS -->
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet"/>
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>

  <!-- html2canvas (for ISC image preview) -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

  <style>
    .font-cursive { font-family: 'Brush Script MT', cursive; }
    .tile-photo { width:100%; height: 20rem; object-fit: cover; background:#e5e7eb; }
    .tile-banner { position:absolute; top:12px; left:12px; background:rgba(0,0,0,.8); color:#fff; font-size:12px; font-weight:600; border-radius:9999px; padding:4px 8px; }
    .heart-btn { position:absolute; top:12px; right:12px; width: 32px; height: 32px; border-radius:9999px; background:rgba(255,255,255,.95); display:flex; align-items:center; justify-content:center; box-shadow:0 1px 3px rgba(0,0,0,.2); }
    .fact-pill { font-size: 12px; background:#f3f4f6; padding:2px 8px; border-radius:9999px; }
    .status-active { background:#d1fae5; color:#047857; }
    .status-contract { background:#fef3c7; color:#92400e; }
    .status-sold { background:#ffe4e6; color:#be123c; }
    .status-draft { background:#e5e7eb; color:#374151; }
  </style>
</head>
<body class="bg-gray-100 text-gray-800">

  <!-- Top bar -->
  <header class="bg-white border-b">
    <div class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
      <a href="/index.html#strip2Search" class="text-sm text-blue-600 hover:underline">&larr; Back to Search</a>
      <h1 class="text-lg font-semibold">GuaranteedCommission.com</h1>
      <a href="/login.html" class="text-sm text-blue-600 hover:underline">Log In</a>
    </div>
  </header>

  <main class="max-w-7xl mx-auto px-4 py-6 space-y-6">

    <!-- STRIP (Top row) -->
    <section class="grid grid-cols-1 lg:grid-cols-4 gap-6">
      <!-- Left: enlarged listing tile (spans 2 cols = half width) -->
      <article id="heroTile" class="lg:col-span-2 bg-white rounded-2xl shadow overflow-hidden relative cursor-pointer">
        <div class="relative">
          <img id="tilePhoto" class="tile-photo" alt="Listing photo"/>
          <div id="tileBanner" class="tile-banner hidden"></div>
          <button id="tileHeart" type="button" class="heart-btn" aria-label="Like"></button>
        </div>
        <div class="p-4 space-y-1">
          <!-- Top line: Price (left) | Commission X% | $Y (right, red) -->
          <div class="flex items-center justify-between text-[16px] sm:text-[18px] font-semibold">
            <div id="tilePrice" class="truncate">$—</div>
            <div id="tileCommission" class="truncate text-red-600">Commission — | $—</div>
          </div>
          <!-- Second line: "3 bds | 2 ba | 2,000 sqft | Active" -->
          <div id="tileFacts" class="text-[12px] text-gray-700">— bds | — ba | — sqft | Draft</div>
          <!-- Third: Full address -->
          <div id="tileAddress" class="text-sm font-medium">[full address]</div>
          <!-- Fourth: Brokerage — Agent — Phone -->
          <div id="tileContact" class="text-[12px] text-gray-600">[LISTING BROKERAGE] — [listing agent] — [agent phone]</div>
        </div>
        <a id="tileClick" href="#" class="absolute inset-0" aria-label="Open full listing detail"></a>
      </article>

      <!-- Middle: Map Search -->
      <aside class="lg:col-span-1 bg-white rounded-2xl shadow p-4">
        <h2 class="text-sm font-semibold mb-2">Map Search</h2>
        <div class="flex gap-2 mb-3">
          <input id="mapQ" class="w-full border rounded px-3 py-2 text-sm" placeholder="Search by city or ZIP">
          <button id="mapRun" class="px-3 py-2 rounded bg-blue-600 text-white text-sm">Go</button>
        </div>
        <div id="mapCanvas" class="h-64 rounded bg-gray-100"></div>
      </aside>

      <!-- Right: ISC preview image -->
      <aside class="lg:col-span-1 bg-white rounded-2xl shadow p-4">
        <div class="flex items-center justify-between">
          <h2 class="text-sm font-semibold">ISC Preview</h2>
          <span id="viewCounter" class="text-xs text-gray-500">0 views</span>
        </div>
        <div class="mt-2 border rounded overflow-hidden bg-gray-50 flex items-center justify-center">
          <img id="iscPreviewImg" alt="ISC preview" class="w-full h-64 object-contain hidden"/>
          <!-- Fallback iframe if preview image fails -->
          <iframe id="iscIframeFallback" src="/printable-isc.html" class="w-full h-64 bg-white"></iframe>
        </div>
        <a href="/printable-isc.html" target="_blank"
           class="mt-3 inline-flex items-center justify-center w-full text-center bg-gray-700 text-white py-2 rounded text-sm">
          Open Full ISC
        </a>

        <!-- Hidden iframe used for snapshot (same-origin) -->
        <iframe id="iscIframeHidden" src="/printable-isc.html" class="hidden"></iframe>
      </aside>
    </section>
