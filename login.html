<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Login | GuaranteedCommission.com</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-900">
  <div class="min-h-screen flex items-center justify-center px-4">
    <div class="w-full max-w-md bg-white rounded-2xl shadow p-6">
      <div class="text-center mb-6">
        <h1 class="text-2xl font-bold">Welcome back</h1>
        <p class="text-sm text-gray-600 mt-1">State-of-the-art security & verification</p>
      </div>

      <!-- Status / errors -->
      <div id="status" class="hidden mb-4 text-sm rounded-lg p-3"></div>

      <form id="loginForm" class="space-y-4" autocomplete="off">
        <div>
          <label for="email" class="block text-sm font-medium text-gray-700">Email</label>
          <input id="email" name="email" type="email" required
                 class="mt-1 w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                 placeholder="you@example.com" />
        </div>

        <div>
          <label for="password" class="block text-sm font-medium text-gray-700">Password</label>
          <div class="relative mt-1">
            <input id="password" name="password" type="password" required
                   class="w-full border rounded-lg px-3 py-2 pr-12 focus:outline-none focus:ring-2 focus:ring-blue-500"
                   placeholder="Your password" />
            <button type="button" id="togglePwd"
                    class="absolute inset-y-0 right-0 px-3 text-sm text-blue-600 hover:underline select-none">
              Show
            </button>
          </div>
        </div>

        <div class="flex items-center justify-between text-sm">
          <a href="/forgot-password.html" class="text-blue-600 hover:underline">Forgot password?</a>
          <a href="/create-account.html" class="text-blue-600 hover:underline">Create account</a>
        </div>

        <button type="submit"
                class="w-full bg-blue-600 text-white py-2 rounded-lg font-semibold hover:bg-blue-700 transition">
          Log In
        </button>
      </form>

      <p class="text-[11px] text-gray-500 text-center mt-4">
        We never sell your data. Used only for escrow & identification.
      </p>
    </div>
  </div>

  <script>
    // Show/Hide password
    (function () {
      const pwd = document.getElementById('password');
      const btn = document.getElementById('togglePwd');
      btn.addEventListener('click', () => {
        const showing = pwd.type === 'text';
        pwd.type = showing ? 'password' : 'text';
        btn.textContent = showing ? 'Show' : 'Hide';
        // Keep focus on the field for accessibility
        pwd.focus({ preventScroll: true });
      });
    })();

    // Simple localStorage-based login (works with our create-account.html)
    const statusBox = document.getElementById('status');
    function setStatus(msg, ok=false) {
      statusBox.classList.remove('hidden');
      statusBox.textContent = msg;
      statusBox.className = ok
        ? 'mb-4 text-sm rounded-lg p-3 bg-green-50 text-green-700'
        : 'mb-4 text-sm rounded-lg p-3 bg-red-50 text-red-700';
    }

    document.getElementById('loginForm').addEventListener('submit', (e) => {
      e.preventDefault();
      const email = document.getElementById('email').value.trim().toLowerCase();
      const password = document.getElementById('password').value;

      const raw = localStorage.getItem('userAccount');
      if (!raw) {
        setStatus('No account found. Please create an account first.');
        setTimeout(() => { window.location.href = '/create-account.html'; }, 900);
        return;
      }

      let acct;
      try { acct = JSON.parse(raw); } catch { acct = null; }
      if (!acct || !acct.email || !acct.password) {
        setStatus('Saved account data is invalid. Please create a new account.');
        setTimeout(() => { window.location.href = '/create-account.html'; }, 900);
        return;
      }

      if (acct.email.toLowerCase() !== email || acct.password !== password) {
        setStatus('Invalid email or password.');
        return;
      }

      // Logged in
      localStorage.setItem('isLoggedIn', 'true');
      localStorage.setItem('loggedInEmail', email);
      setStatus('Login successful. Redirecting…', true);

      // If we’re mid-flow, continue; otherwise go home
      const continueTo = localStorage.getItem('nextAfterLogin');
      setTimeout(() => {
        if (continueTo) {
          window.location.href = continueTo;
        } else {
          window.location.href = '/index.html';
        }
      }, 600);
    });
  </script>
</body>
</html>
