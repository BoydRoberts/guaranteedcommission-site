<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Log In | GuaranteedCommission.com</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-900">

  <div class="max-w-md mx-auto mt-12 bg-white p-6 md:p-8 rounded shadow">
    <div class="flex items-center justify-center gap-2">
      <svg width="20" height="20" fill="currentColor" class="text-green-600"><path d="M10 2a5 5 0 00-5 5v2H4a2 2 0 00-2 2v5a2 2 0 002 2h12a2 2 0 002-2v-5a2 2 0 00-2-2h-1V7a5 5 0 00-5-5zm-3 7V7a3 3 0 016 0v2H7zm-1 2h8a1 1 0 011 1v3a1 1 0 01-1 1H6a1 1 0 01-1-1v-3a1 1 0 011-1z"/></svg>
      <h1 class="text-2xl md:text-3xl font-bold">Secure Login</h1>
    </div>
    <p class="text-center text-xs text-gray-500 mt-1">
      State-of-the-art security. Your data is used only for escrow & identification.
    </p>

    <form id="loginForm" class="space-y-4 mt-6" autocomplete="off">
      <!-- Role (kept for routing intents) -->
      <div>
        <label class="block text-sm font-medium mb-1">I am a</label>
        <select id="role" class="w-full border rounded p-2">
          <option value="seller">Seller</option>
          <option value="agent">Listing Agent</option>
        </select>
      </div>

      <div>
        <label for="email" class="block text-sm font-medium mb-1">Email</label>
        <input id="email" type="email" class="w-full border rounded p-2" placeholder="you@example.com" required>
      </div>

      <div>
        <label for="password" class="block text-sm font-medium mb-1">Password</label>
        <div class="relative">
          <input id="password" type="password" class="w-full border rounded p-2 pr-16" placeholder="Enter your password" required>
          <button type="button" id="togglePw" class="absolute right-2 top-1/2 -translate-y-1/2 text-xs text-blue-600">Show</button>
        </div>
      </div>

      <div class="flex items-center justify-between text-sm">
        <label class="flex items-center gap-2">
          <input type="checkbox" id="remember" class="rounded">
          Remember me on this device
        </label>
        <a class="text-blue-600 hover:underline" href="/forgot-password.html">Forgot password?</a>
      </div>

      <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded font-semibold">
        Log In
      </button>

      <p class="text-center text-sm">
        New here?
        <a href="/create-account.html" class="text-blue-600 hover:underline">Create an account</a>
      </p>

      <p id="status" class="text-center text-sm text-red-600"></p>
    </form>
  </div>

  <script>
    // Prefill email if "remember me" was used before
    window.addEventListener("DOMContentLoaded", () => {
      try {
        const remembered = localStorage.getItem("rememberedEmail");
        if (remembered) {
          document.getElementById("email").value = remembered;
          document.getElementById("remember").checked = true;
        }
      } catch {}
    });

    // Show/hide password
    document.getElementById("togglePw").addEventListener("click", () => {
      const pw = document.getElementById("password");
      const btn = document.getElementById("togglePw");
      if (pw.type === "password") {
        pw.type = "text"; btn.textContent = "Hide";
      } else {
        pw.type = "password"; btn.textContent = "Show";
      }
    });

    // Simple client-side login stub (until Firebase Auth is wired)
    document.getElementById("loginForm").addEventListener("submit", (e) => {
      e.preventDefault();
      const status = document.getElementById("status");
      status.textContent = "";

      const role = document.getElementById("role").value;
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value;
      const remember = document.getElementById("remember").checked;

      // Minimal validation
      const emailOk = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(email);
      if (!emailOk || !password) {
        status.textContent = "Please enter a valid email and password.";
        return;
      }

      // Remember me
      try {
        if (remember) {
          localStorage.setItem("rememberedEmail", email);
        } else {
          localStorage.removeItem("rememberedEmail");
        }
      } catch {}

      // Simulate auth success and set active user
      const activeUser = { email, role, lastLogin: Date.now() };
      localStorage.setItem("activeUser", JSON.stringify(activeUser));

      // Respect any prior intent from the flow (set during upsell/verify)
      const intent = localStorage.getItem("loginIntent");
      if (intent === "agent-complete-listing") {
        window.location.href = "/agent-detail.html";
        return;
      }
      if (intent === "seller-complete-listing") {
        window.location.href = "/seller-detail.html";
        return;
      }

      // Fallback: route by role
      if (role === "agent") {
        window.location.href = "/agent-detail.html";
      } else {
        window.location.href = "/seller-detail.html";
      }
    });
  </script>
</body>
</html>
