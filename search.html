<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Search Guaranteed Commissions | GuaranteedCommission.com</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-900">

  <!-- Header -->
  <header class="bg-white shadow">
    <div class="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
      <a href="/index.html" class="text-xl font-bold">GuaranteedCommission.com</a>
      <a href="/login.html" class="text-sm text-blue-600 hover:underline">Log In</a>
    </div>
  </header>

  <!-- Search bar (non-functional placeholder for now) -->
  <section class="max-w-7xl mx-auto px-4 mt-6">
    <div class="bg-white rounded-2xl shadow p-4">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
        <input id="q" class="border rounded px-3 py-2" placeholder="City, neighborhood, ZIP"/>
        <select id="status" class="border rounded px-3 py-2">
          <option value="">Any status</option>
          <option value="active">Active</option>
          <option value="in_contract">In Contract</option>
          <option value="sold">Sold</option>
        </select>
        <select id="plan" class="border rounded px-3 py-2">
          <option value="">Any plan</option>
          <option value="Listed Property Basic">Listed Property Basic</option>
          <option value="Listed Property Plus">Listed Property Plus</option>
          <option value="FSBO Plus">FSBO Plus</option>
        </select>
        <button id="run" class="bg-blue-600 text-white rounded px-3 py-2">Search</button>
      </div>
    </div>
  </section>

  <!-- Results -->
  <section class="max-w-7xl mx-auto px-4 mt-6 mb-10">
    <div class="flex items-center justify-between mb-3">
      <h2 class="text-lg font-semibold">Results</h2>
      <div class="text-xs text-gray-600">
        <button id="loadSample" class="underline">Load sample data</button>
      </div>
    </div>
    <div id="grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>
  </section>

  <!-- Tiles helper -->
  <script src="/scripts/tiles.js"></script>
  <script>
    // Build a multi-item list from localStorage + mocks
    function sample() {
      const formData  = JSON.parse(localStorage.getItem('formData') || '{}');
      const agentData = JSON.parse(localStorage.getItem('agentListing') || '{}');
      const selectedPlan = (localStorage.getItem('selectedPlan') || 'Listed Property Basic').trim();

      const list = [];

      // If you have a real listing in localStorage, include it first
      if (formData.address) {
        list.push({
          formData,
          agentData: Object.assign({ status: agentData.status || 'active' }, agentData),
          plan: selectedPlan
        });
      }

      // Add a few mock items for variety
      list.push(
        {
          formData:  { address: '100 Ocean Ave, Laguna Beach, CA 92651' },
          agentData: {
            price: 2750000, commission: 2.5, commissionType: '%',
            beds: 3, baths: 3, sqft: 2100, bannerText: 'Open Sun 1â€“4',
            status: 'active',
            photos: ['https://picsum.photos/seed/gc1/800/450']
          },
          plan: 'Listed Property Plus'
        },
        {
          formData:  { address: '42 Canyon Rd, Laguna Beach, CA 92651' },
          agentData: {
            price: 1495000, commission: 30000, commissionType: '$',
            beds: 2, baths: 2, sqft: 1400,
            status: 'in_contract',
            photos: ['https://picsum.photos/seed/gc2/800/450']
          },
          plan: 'Listed Property Basic'
        },
        {
          formData:  { address: '9 Bluebird Ln, Laguna Beach, CA 92651' },
          agentData: {
            price: 3299000, commission: 2.25, commissionType: '%',
            beds: 4, baths: 4, sqft: 3000,
            status: 'sold',
            photos: ['https://picsum.photos/seed/gc3/800/450']
          },
          plan: 'FSBO Plus'
        }
      );

      return list;
    }

    // Simple client-side "filter"
    function filterList(list, query, status, plan) {
      const q = (query||'').toLowerCase().trim();
      return list.filter(item => {
        const addr = (item.formData?.address || '').toLowerCase();
        const okQ = q ? addr.includes(q) : true;
        const okS = status ? (String(item.agentData?.status||'').toLowerCase() === status) : true;
        const okP = plan ? (String(item.plan||'') === plan) : true;
        return okQ && okS && okP;
      });
    }

    (function init(){
      const grid = document.getElementById('grid');
      const list = sample();

      // Initial render
      renderTileList(list, grid, {
        clear: true,
        onClick: (item) => {
          // For now, go to an existing preview page
          window.location.href = '/agent-preview.html';
        }
      });

      // Wire sample reload
      document.getElementById('loadSample').addEventListener('click', (e) => {
        e.preventDefault();
        const fresh = sample();
        renderTileList(fresh, grid, { clear: true });
      });

      // Wire faux search
      document.getElementById('run').addEventListener('click', () => {
        const q = document.getElementById('q').value;
        const s = document.getElementById('status').value;
        const p = document.getElementById('plan').value;
        const filtered = filterList(sample(), q, s, p);
        renderTileList(filtered, grid, { clear: true });
      });
    })();
  </script>
</body>
</html>
