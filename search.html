<!DOCTYPE html>
<!-- search.html - Build 2026-02-11 (Firestore integration via search.js module) -->
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Search | GuaranteedCommission.com</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Mapbox GL JS -->
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet"/>
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>

  <style>
    html, body { height: 100%; }
    .mapboxgl-canvas { outline: none; }

    /* Tile styles */
    .gc-tile { background:#fff; border-radius:0.75rem; overflow:hidden; box-shadow:0 1px 6px rgba(0,0,0,.08); cursor:pointer; }
    .gc-photo { width:100%; height:180px; object-fit:cover; background:#e5e7eb; }
    .gc-ribbon { position:absolute; top:10px; left:10px; background:rgba(0,0,0,.75); color:#fff; font-size:12px; padding:4px 8px; border-radius:6px; }
    .gc-heart { position:absolute; top:10px; right:10px; width:32px; height:32px; border-radius:9999px; background:rgba(255,255,255,.95); display:flex; align-items:center; justify-content:center; box-shadow:0 1px 3px rgba(0,0,0,.2); border:none; cursor:pointer; }
    .gc-share { position:absolute; bottom:10px; padding:.35rem .6rem; font-size:12px; background:#fff; border:1px solid #e5e7eb; border-radius:6px; box-shadow:0 1px 3px rgba(0,0,0,.12); cursor:pointer; }
    .gc-share-left { left:10px; }
    .gc-share-right { right:10px; }

    /* 50/50 layout */
    .search-layout { display:flex; flex-direction:column; height:100vh; }
    .search-header { flex-shrink:0; }
    .search-body { flex:1; display:flex; overflow:hidden; }
    .search-map { width:50%; height:100%; flex-shrink:0; background:#fff; }
    .search-map #mapCanvas { width:100%; height:100%; }
    .search-results { width:50%; height:100%; overflow-y:auto; background:#f3f4f6; padding:1rem; }
    .search-results #grid { display:grid; grid-template-columns:repeat(2, 1fr); gap:1rem; }

    @media (max-width: 1023px) {
      .search-body { flex-direction:column; }
      .search-map { width:100%; height:300px; }
      .search-results { width:100%; height:auto; flex:1; }
      .search-results #grid { grid-template-columns:1fr; }
    }

    /* ===== MARKER STYLES ===== */
    /* Default: ACTIVE listings = BLUE (#4DA6FF) */
    .gc-marker-wrap { position:relative; width:0; height:0; }
    .gc-marker-dot {
      position:absolute;
      width:10px; height:10px;
      background:#4DA6FF;
      border:2px solid #fff;
      border-radius:9999px;
      box-shadow:0 1px 2px rgba(0,0,0,.3);
      left:0; top:0;
      transform:translate(-50%, -50%);
      cursor:pointer;
    }
    .gc-marker-label {
      position:absolute;
      left:10px; top:0;
      transform:translate(0, -50%);
      display:inline-flex;
      align-items:center;
      justify-content:center;
      background:#fff;
      border:2px solid #4DA6FF;
      border-radius:9999px;
      padding:2px 8px;
      font-size:12px;
      font-weight:700;
      color:#4DA6FF;
      white-space:nowrap;
      box-shadow:0 2px 6px rgba(0,0,0,.18);
      cursor:pointer;
      user-select:none;
    }
    .gc-marker-wrap.highlighted .gc-marker-label { background:#4DA6FF; color:#fff; }
    .gc-marker-wrap.highlighted .gc-marker-dot { box-shadow:0 3px 10px rgba(77,166,255,.45); }
    .gc-tile.highlighted { outline:3px solid #4DA6FF; outline-offset:2px; box-shadow:0 4px 12px rgba(77,166,255,.3); }

    /* ===== PENDING / IN CONTRACT = BLACK (#1f2937) ===== */
    .gc-marker-wrap.pending .gc-marker-dot {
      background:#1f2937;
    }
    .gc-marker-wrap.pending .gc-marker-label {
      background:#fff;
      border-color:#1f2937;
      color:#1f2937;
    }
    .gc-marker-wrap.pending.highlighted .gc-marker-label {
      background:#1f2937;
      color:#fff;
    }
    .gc-marker-wrap.pending.highlighted .gc-marker-dot {
      box-shadow:0 3px 10px rgba(31,41,55,.45);
    }

    /* ===== SOLD = RED (#dc2626) ===== */
    .gc-marker-wrap.sold .gc-marker-dot {
      background:#dc2626;
    }
    .gc-marker-wrap.sold .gc-marker-label {
      background:#fff;
      border-color:#dc2626;
      color:#dc2626;
    }
    .gc-marker-wrap.sold.highlighted .gc-marker-label {
      background:#dc2626;
      color:#fff;
    }
    .gc-marker-wrap.sold.highlighted .gc-marker-dot {
      box-shadow:0 3px 10px rgba(220,38,38,.45);
    }

    /* Filter bar dropdown styling */
    .filter-dropdown { position:relative; display:inline-block; }
    .filter-btn {
      display:inline-flex;
      align-items:center;
      gap:4px;
      padding:8px 12px;
      font-size:14px;
      font-weight:500;
      background:#4DA6FF;
      color:#fff;
      border:1px solid #4DA6FF;
      border-radius:8px;
      cursor:pointer;
      white-space:nowrap;
    }
    .filter-btn:hover { opacity:0.9; }
    .filter-btn:focus { outline:none; }
    .filter-btn.active { background:#4DA6FF; border-color:#4DA6FF; }
    .filter-btn svg { width:12px; height:12px; transition:transform 0.15s; fill:#fff; }
    .filter-dropdown.open .filter-btn svg { transform:rotate(180deg); }

    .filter-panel {
      position:absolute;
      top:calc(100% + 4px);
      left:0;
      min-width:200px;
      background:#fff;
      border:1px solid #e5e7eb;
      border-radius:8px;
      box-shadow:0 4px 16px rgba(0,0,0,.12);
      padding:12px;
      z-index:100;
      display:none;
    }
    .filter-dropdown.open .filter-panel { display:block; }
    .filter-panel.right { left:auto; right:0; }

    .filter-panel label { display:block; font-size:12px; color:#6b7280; margin-bottom:4px; }
    .filter-panel input, .filter-panel select {
      width:100%;
      padding:6px 8px;
      font-size:14px;
      border:1px solid #d1d5db;
      border-radius:6px;
      margin-bottom:8px;
    }
    .filter-panel input:focus, .filter-panel select:focus {
      outline:none;
      border-color:#4DA6FF;
    }
    .filter-apply-btn {
      width:100%;
      padding:8px;
      font-size:14px;
      font-weight:500;
      color:#fff;
      background:#4DA6FF;
      border:none;
      border-radius:6px;
      cursor:pointer;
    }
    .filter-apply-btn:hover { opacity:0.9; }

    /* Saved search autocomplete dropdown */
    .search-autocomplete {
      position:absolute;
      top:100%;
      left:0;
      right:0;
      background:#fff;
      border:1px solid #e5e7eb;
      border-top:none;
      border-radius:0 0 8px 8px;
      box-shadow:0 4px 12px rgba(0,0,0,.1);
      max-height:200px;
      overflow-y:auto;
      z-index:200;
      display:none;
    }
    .search-autocomplete.show { display:block; }
    .search-autocomplete-item {
      padding:10px 12px;
      cursor:pointer;
      font-size:14px;
      border-bottom:1px solid #f3f4f6;
    }
    .search-autocomplete-item:last-child { border-bottom:none; }
    .search-autocomplete-item:hover { background:#f3f4f6; }
    .search-autocomplete-item .saved-label {
      font-size:11px;
      color:#4DA6FF;
      margin-left:8px;
    }
    
    /* SOLD STATUS DISPLAY - High visibility styling */
    .sold-details-text {
      color: #b91c1c; /* red-700 for visibility */
      font-weight: 700;
      font-size: 11px;
    }
  </style>
</head>

<body class="search-layout text-gray-900">

  <!-- ========== STRIP 1: BRANDED HEADER ========== -->
  <div class="search-header">
    <header class="bg-white border-b">
      <div class="max-w-7xl mx-auto px-4 py-3">
        <div class="flex items-center justify-between">
          <a href="/index.html" class="text-sm font-medium hover:underline" style="color:#4DA6FF;">Home</a>

          <div class="text-center">
            <div class="flex items-end justify-center gap-0">
              <img src="/Logo.png" alt="GuaranteedCommission Logo" class="h-10 w-10 object-contain -mr-1 -mb-1">
              <h1 class="text-3xl font-bold">GuaranteedCommission.com</h1>
            </div>
          </div>

          <div class="flex items-center gap-4">
            <a href="/advertise.html" class="text-sm font-medium hover:underline" style="color:#4DA6FF;">Advertise</a>
            <a href="/login.html" id="authLink" class="text-sm font-medium hover:underline" style="color:#4DA6FF;">Log In</a>
          </div>
        </div>
      </div>
    </header>

    <!-- ========== STRIP 2: ZILLOW-STYLE FILTER BAR ========== -->
    <section class="bg-white border-b">
      <div class="px-2 py-2">
        <div class="flex flex-wrap items-center gap-2">

          <!-- Search Input -->
          <div class="w-[320px] relative">
            <input id="qBox" type="text" class="w-full border-2 border-gray-300 rounded-lg px-4 py-3 text-base focus:outline-none focus:border-[#4DA6FF]" placeholder="City, ZIP, or Saved Search" autocomplete="off">
            <div id="searchAutocomplete" class="search-autocomplete"></div>
          </div>

          <!-- For Sale Dropdown -->
          <div class="filter-dropdown" data-filter="status">
            <button class="filter-btn" type="button">
              <span>For Sale</span>
              <svg viewBox="0 0 24 24"><path fill="currentColor" d="M12 15.5L5 8.5l1.4-1.4L12 12.7l5.6-5.6L19 8.5z"/></svg>
            </button>
            <div class="filter-panel">
              <select id="status" class="w-full">
                <option value="">Any Status</option>
                <option value="Active">Active</option>
                <option value="In Contract">In Contract</option>
                <option value="Sold">Sold</option>
              </select>
              <button class="filter-apply-btn" data-apply="status">Apply</button>
            </div>
          </div>

          <!-- Price Dropdown -->
          <div class="filter-dropdown" data-filter="price">
            <button class="filter-btn" type="button">
              <span>Price</span>
              <svg viewBox="0 0 24 24"><path fill="currentColor" d="M12 15.5L5 8.5l1.4-1.4L12 12.7l5.6-5.6L19 8.5z"/></svg>
            </button>
            <div class="filter-panel">
              <label>Min Price</label>
              <input id="priceMin" type="number" min="0" step="50000" placeholder="No Min">
              <label>Max Price</label>
              <input id="priceMax" type="number" min="0" step="50000" placeholder="No Max">
              <button class="filter-apply-btn" data-apply="price">Apply</button>
            </div>
          </div>

          <!-- Beds Dropdown -->
          <div class="filter-dropdown" data-filter="beds">
            <button class="filter-btn" type="button">
              <span>Beds</span>
              <svg viewBox="0 0 24 24"><path fill="currentColor" d="M12 15.5L5 8.5l1.4-1.4L12 12.7l5.6-5.6L19 8.5z"/></svg>
            </button>
            <div class="filter-panel">
              <label>Min Bedrooms</label>
              <select id="bedsMin">
                <option value="">Any</option>
                <option value="1">1+</option>
                <option value="2">2+</option>
                <option value="3">3+</option>
                <option value="4">4+</option>
                <option value="5">5+</option>
              </select>
              <button class="filter-apply-btn" data-apply="beds">Apply</button>
            </div>
          </div>

          <!-- Baths Dropdown -->
          <div class="filter-dropdown" data-filter="baths">
            <button class="filter-btn" type="button">
              <span>Baths</span>
              <svg viewBox="0 0 24 24"><path fill="currentColor" d="M12 15.5L5 8.5l1.4-1.4L12 12.7l5.6-5.6L19 8.5z"/></svg>
            </button>
            <div class="filter-panel">
              <label>Min Bathrooms</label>
              <select id="bathsMin">
                <option value="">Any</option>
                <option value="1">1+</option>
                <option value="1.5">1.5+</option>
                <option value="2">2+</option>
                <option value="2.5">2.5+</option>
                <option value="3">3+</option>
                <option value="4">4+</option>
              </select>
              <button class="filter-apply-btn" data-apply="baths">Apply</button>
            </div>
          </div>

          <!-- Type Dropdown -->
          <div class="filter-dropdown" data-filter="propType">
            <button class="filter-btn" type="button">
              <span>Type</span>
              <svg viewBox="0 0 24 24"><path fill="currentColor" d="M12 15.5L5 8.5l1.4-1.4L12 12.7l5.6-5.6L19 8.5z"/></svg>
            </button>
            <div class="filter-panel">
              <select id="propType">
                <option value="">Any Type</option>
                <option value="Single Family">Single Family</option>
                <option value="Condo">Condo</option>
                <option value="Townhouse">Townhouse</option>
                <option value="Multi-Family">Multi-Family</option>
                <option value="Land">Land</option>
                <option value="Other">Other</option>
              </select>
              <button class="filter-apply-btn" data-apply="propType">Apply</button>
            </div>
          </div>

          <div class="flex-1"></div>

          <!-- Share / Save -->
          <div class="filter-dropdown" data-filter="share-save">
            <button class="px-4 py-2 text-sm font-medium text-white rounded-lg" style="background:#4DA6FF;" type="button">
              Share / Save
              <svg class="inline-block ml-1 w-3 h-3" viewBox="0 0 24 24"><path fill="currentColor" d="M12 15.5L5 8.5l1.4-1.4L12 12.7l5.6-5.6L19 8.5z"/></svg>
            </button>
            <div class="filter-panel right" style="min-width:280px;">
              <div class="mb-4">
                <label class="block text-sm font-semibold text-gray-700 mb-2">Save Current Search</label>
                <input id="searchNameInput" type="text" class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm mb-2" placeholder="Name this search...">
                <button id="saveSearchBtn" class="w-full px-3 py-2 text-sm font-medium text-white rounded-lg" style="background:#4DA6FF;">
                  Save Search
                </button>
              </div>

              <hr class="my-3 border-gray-200">

              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">Share Results Now</label>
                <div class="grid grid-cols-2 gap-2">
                  <button id="emailSearchBtn" class="px-3 py-2 text-sm font-medium text-white rounded-lg" style="background:#4DA6FF;">
                    Email Results
                  </button>
                  <button id="textSearchBtn" class="px-3 py-2 text-sm font-medium text-white rounded-lg" style="background:#4DA6FF;">
                    Text Results
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Clear -->
          <button id="clearFiltersBtn" class="px-3 py-2 text-sm text-white rounded-lg" style="background:#4DA6FF;">
            Clear
          </button>

          <!-- Auto-Notify -->
          <div class="filter-dropdown" data-filter="auto-notify">
            <button class="px-4 py-2 text-sm font-medium text-white rounded-lg" style="background:#4DA6FF;" type="button">
              Auto-Notify
              <svg class="inline-block ml-1 w-3 h-3" viewBox="0 0 24 24"><path fill="currentColor" d="M12 15.5L5 8.5l1.4-1.4L12 12.7l5.6-5.6L19 8.5z"/></svg>
            </button>
            <div class="filter-panel right" style="min-width:280px;">
              <label class="block text-sm font-semibold text-gray-700 mb-2">Auto-Notify on New Listings</label>
              <p class="text-xs text-gray-500 mb-3">Get notified when new listings match this search</p>
              <div class="grid grid-cols-2 gap-2">
                <button id="autoEmailBtn" class="px-3 py-2 text-sm font-medium text-white rounded-lg" style="background:#4DA6FF;">
                  Auto-Email
                </button>
                <button id="autoTextBtn" class="px-3 py-2 text-sm font-medium text-white rounded-lg" style="background:#4DA6FF;">
                  Auto-Text
                </button>
              </div>
            </div>
          </div>

        </div>
      </div>
    </section>
  </div>

  <!-- MAP + RESULTS -->
  <div class="search-body">
    <div class="search-map"><div id="mapCanvas"></div></div>
    <div class="search-results"><div id="grid"></div></div>
  </div>

  <!-- Firebase init (must load before search.js) -->
  <script type="module" src="/scripts/firebase-init.js"></script>
  
  <!-- Main search logic (ES6 module with Firestore integration) -->
  <script type="module" src="/search.js"></script>

</body>
</html>
