<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Who Will Complete the Listing? | GuaranteedCommission.com</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .font-cursive { font-family: "Brush Script MT", cursive; }
  </style>
</head>
<body class="bg-gray-100 text-gray-900">

  <!-- Top bar -->
  <div class="max-w-5xl mx-auto mt-6 mb-2 flex items-center justify-between text-sm px-2">
    <a href="/" class="text-blue-600 underline">Back to Home</a>
    <a href="/login.html" class="text-blue-600 underline">Log In</a>
  </div>

  <div class="max-w-5xl mx-auto bg-white rounded shadow p-6 mt-2">
    <h1 class="text-2xl font-bold text-center">Who Will Complete the Listing?</h1>
    <p class="text-center text-gray-600 mt-1">Choose how you’d like to finish the listing details.</p>

    <div class="grid md:grid-cols-3 gap-6 mt-8">
      <!-- Left: Options -->
      <div class="md:col-span-2 space-y-6">
        <!-- Option A: Invite agent -->
        <div class="border rounded p-5">
          <div class="flex items-start gap-3">
            <div class="shrink-0">
              <input id="optAgent" type="radio" name="who" value="agent" class="mt-1" checked />
            </div>
            <div class="grow">
              <label for="optAgent" class="block font-semibold text-lg">Invite my agent to complete the listing</label>
              <p class="text-sm text-gray-600 mt-1">
                Your listing tile will go live immediately with a “Coming soon” photo, “Price coming soon,” and
                blank beds/baths. We’ll display the listing brokerage, listing agent, and agent phone so agents
                can contact you. Your agent will receive an invite to fill in photos, price, description, and details.
              </p>

              <!-- Agent invite form -->
              <form id="agentForm" class="grid sm:grid-cols-2 gap-3 mt-4">
                <input type="text" id="agentName" placeholder="Listing Agent Name" class="border rounded p-2 w-full">
                <input type="text" id="agentBrokerage" placeholder="Listing Brokerage" class="border rounded p-2 w-full">
                <input type="tel" id="agentPhone" placeholder="Agent Phone (123-456-7890)" class="border rounded p-2 w-full">
                <input type="email" id="agentEmail" placeholder="Agent Email" class="border rounded p-2 w-full">
                <div class="sm:col-span-2 flex items-center justify-between mt-1">
                  <p class="text-xs text-gray-500">
                    We’ll verify the agent by email or phone. The address must match to access the listing.
                  </p>
                  <button type="button" id="sendInviteBtn" class="bg-blue-600 text-white px-4 py-2 rounded">
                    Send Invite & Publish Stub
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>

        <!-- Option B: Seller completes -->
        <div class="border rounded p-5">
          <div class="flex items-start gap-3">
            <div class="shrink-0">
              <input id="optSeller" type="radio" name="who" value="seller" class="mt-1" />
            </div>
            <div class="grow">
              <label for="optSeller" class="block font-semibold text-lg">I’ll complete the listing details myself</label>
              <p class="text-sm text-gray-600 mt-1">
                You’ll be able to add price, details, and one photo with the Basic plan.
                Upgrade to Plus to unlock a full description and up to 20 photos.
              </p>
              <div class="mt-3">
                <button id="sellerContinueBtn" class="bg-green-600 text-white px-4 py-2 rounded">
                  Continue to Listing Details
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Helper tips -->
        <div class="text-xs text-gray-500">
          Tip: You can invite your agent now and still add your own details later. Agents can also pay to
          upgrade to Plus and Pin Placement from their dashboard at any time.
        </div>
      </div>

      <!-- Right: Recap -->
      <aside class="border rounded p-5 h-fit">
        <h2 class="font-semibold mb-3">Listing Recap</h2>
        <div class="text-sm">
          <div class="mb-2">
            <div class="text-gray-500">Address</div>
            <div id="recapAddress" class="font-medium">—</div>
          </div>
          <div class="mb-2">
            <div class="text-gray-500">Plan</div>
            <div id="recapPlan" class="font-medium">—</div>
          </div>
          <div class="mb-2">
            <div class="text-gray-500">Commission</div>
            <div class="font-medium">
              <span id="recapCommission">—</span>
              <span id="recapSuffix"></span>
            </div>
          </div>
          <hr class="my-3">
          <p class="text-xs text-gray-500">
            Your tile appears in Search (Strip 2). Until details are filled, we’ll show a placeholder image and
            limited info so buyer agents can see your guaranteed commission and contact info.
          </p>
        </div>
      </aside>
    </div>
  </div>

  <script>
    // Pull known data
    const formData = JSON.parse(localStorage.getItem("formData") || "{}");
    const checkoutData = JSON.parse(localStorage.getItem("checkoutData") || "{}");
    const selectedPlan = checkoutData.plan || localStorage.getItem("selectedPlan") || "Listed Property Basic";

    // Prefill recap
    const fullAddr = formData.address || "—";
    const commissionType = formData.commissionType || "%";
    const commission = formData.commission || "";
    const commissionDisplay = commissionType === "$" ? (commission ? "$" + commission : "—") : (commission ? commission + "%" : "—");
    const suffix = commission && commissionType === "%" ? " of the total purchase price" : "";

    document.getElementById("recapAddress").textContent = fullAddr;
    document.getElementById("recapPlan").textContent = selectedPlan;
    document.getElementById("recapCommission").textContent = commissionDisplay;
    document.getElementById("recapSuffix").textContent = suffix ? " " + suffix : "";

    // Prefill agent form from earlier inputs if present
    document.getElementById("agentName").value = formData.agent || "";
    document.getElementById("agentBrokerage").value = formData.brokerage || "";
    document.getElementById("agentPhone").value = formData.phone || "";
    document.getElementById("agentEmail").value = ""; // typically wasn’t in Box 2

    // Radio interactions: clicking button selects radio
    document.getElementById("sellerContinueBtn").addEventListener("click", () => {
      document.getElementById("optSeller").checked = true;
      // Route to seller details
      window.location.href = "/seller-detail.html";
    });

    document.getElementById("sendInviteBtn").addEventListener("click", () => {
      document.getElementById("optAgent").checked = true;

      // Basic validation
      const name = document.getElementById("agentName").value.trim();
      const brokerage = document.getElementById("agentBrokerage").value.trim();
      const phone = document.getElementById("agentPhone").value.trim();
      const email = document.getElementById("agentEmail").value.trim();

      if (!name || !brokerage || !phone || !email) {
        alert("Please complete all agent fields before sending the invite.");
        return;
      }

      // Save agent invite details
      const agentInvite = {
        name,
        brokerage,
        phone,
        email,
        address: formData.address || "",
        shortAddress: (formData.address || "").split(",")[0] || "",
        requestedAt: new Date().toISOString()
      };
      localStorage.setItem("agentInvite", JSON.stringify(agentInvite));
      localStorage.setItem("loginIntent", "agent-complete-listing");

      // Publish a stub/listing placeholder (for Strip 2 tiles)
      // Your strip 2 code can read this and show a “coming soon” tile
      const stub = {
        address: formData.address || "",
        shortAddress: (formData.address || "").split(",")[0] || "",
        plan: selectedPlan,
        commissionDisplay,
        commissionType,
        commissionRaw: formData.commission || "",
        listingBrokerage: brokerage,
        listingAgent: name,
        listingAgentPhone: phone,
        price: "", // coming soon
        beds: "",  // blank
        baths: "", // blank
        photo: "coming-soon", // use a placeholder in your tiles
        status: "stub-live",
        createdAt: new Date().toISOString()
      };
      localStorage.setItem("listingStub", JSON.stringify(stub));
      localStorage.setItem("listingStatus", "stub-live");

      // In a real system: send email/SMS here.
      alert("Agent invite sent! Your listing tile is live with a placeholder. Redirecting…");

      // Go to thank you
      window.location.href = "/thank-you.html";
    });
  </script>
</body>
</html>
