<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Review Cart and Checkout | GuaranteedCommission.com</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://js.stripe.com/v3/"></script>
</head>
<body class="bg-gray-100 text-gray-800">

  <div class="max-w-xl mx-auto mt-10 bg-white p-6 rounded shadow">
    <h1 class="text-2xl font-bold text-center mb-6">Review & Checkout</h1>

    <div class="space-y-4 text-sm">
      <p><strong>Selected Plan:</strong> <span id="selectedPlan">Loading...</span> - $<span id="planCost">0</span></p>

      <div>
        <strong>Upgrades:</strong>
        <ul id="upgradeList" class="list-disc list-inside text-gray-700"></ul>
      </div>

      <p class="mt-4 text-lg font-bold">Total: $<span id="totalAmountConfirm">0</span></p>
    </div>

    <button id="proceedPaymentBtn" class="w-full bg-green-600 text-white py-2 rounded mt-6">
      Pay Now with Stripe
    </button>

    <p class="text-sm text-center mt-6">
      Need to log in first?
      <a href="/login.html" class="text-blue-600 hover:underline">Go to login</a>
    </p>
  </div>

  <script>
    // Read checkout data
    const checkoutData = JSON.parse(localStorage.getItem("checkoutData") || "{}");

    const plan = checkoutData.plan || "No plan selected";
    const planCost = checkoutData.planCost || 0;
    const upgrades = checkoutData.upgrades || [];
    const totalCost = checkoutData.totalCost || 0;

    document.getElementById("selectedPlan").innerText = plan;
    document.getElementById("planCost").innerText = planCost;
    document.getElementById("totalAmountConfirm").innerText = totalCost;

    const upgradeList = document.getElementById("upgradeList");
    upgradeList.innerHTML = upgrades.length 
      ? upgrades.map(up => `<li>${up}</li>`).join("") 
      : "<li>None</li>";

    document.getElementById("proceedPaymentBtn").addEventListener("click", () => {
      if(totalCost === 0){
        alert("No payment required. Proceeding to signature page...");
        window.location.href = "/signature.html";
        return;
      }
      // Redirect to Stripe checkout
      window.location.href = "/checkout-stripe.html";
    });
  </script>

</body>
</html>
